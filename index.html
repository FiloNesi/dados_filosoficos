<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji Warm-Up! Integrado</title>
    
    <!-- Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- Estilos Globales y Animaciones --- */
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .screen {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            box-sizing: border-box;
            overflow-y: auto; /* Permite scroll si el contenido excede la altura */
            transition: opacity 0.3s ease-in-out;
        }
        
        .hidden { 
            display: none !important; 
        }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes popIn {
            0% { opacity: 0; transform: scale(0.8); }
            80% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }
        @keyframes pop-in-slide-up {
            0% { opacity: 0; transform: translateY(20px) scale(0.95); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        @keyframes animate-border { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes glow {
            0%, 100% { transform: scale(1); text-shadow: 0 0 5px rgba(255, 255, 255, 0.7), 0 0 10px rgba(246, 138, 184, 0.5); }
            50% { transform: scale(1.1); text-shadow: 0 0 10px rgba(255, 255, 255, 1), 0 0 20px rgba(246, 138, 184, 1); }
        }
        @keyframes countdown { from { width: 100%; } to { width: 0%; } }
        @keyframes sparkle {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            100% { transform: scale(1.5) rotate(360deg); opacity: 0; }
        }
        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* --- Estilos Pantalla de Inicio (Warmup) --- */
        #warmup-screen {
            font-family: 'Nunito', sans-serif;
            background: radial-gradient(circle at 50% 50%, #e6f7f3, #d0f0e8);
            color: #3d4f63;
            text-align: center;
            position: relative;
        }
        
        #warmup-screen::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-image: url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23ffffff" fill-opacity="0.4"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
            opacity: 0.2;
            z-index: 0;
        }

        #warmup-screen .main-container {
            position: relative;
            z-index: 1;
            width: 100%;
            max-width: 1300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            animation: fadeIn 1s ease-in-out;
        }

        #warmup-screen .title-container {
            animation: popIn 0.8s 0.2s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;
            opacity: 0;
            margin-bottom: 0.5rem;
        }
        #warmup-screen .main-title {
            font-family: 'Fredoka', sans-serif;
            font-size: clamp(2.5rem, 8vw, 3.2rem);
            font-weight: 700;
            color: #E5989B;
            text-shadow: 2px 2px 0px #ffffff, 4px 4px 8px rgba(0,0,0,0.1);
            margin: 0;
            line-height: 1.1;
        }
        #warmup-screen .subtitle {
            font-size: clamp(1rem, 4vw, 1.1rem);
            font-weight: 400;
            color: #5a6b80;
            margin-top: 0.25rem;
        }

        #warmup-screen .video-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 500px;
            border-radius: 2rem;
            box-shadow: 0 20px 40px -10px rgba(45, 55, 72, 0.2);
            overflow: hidden;
            background-color: #000;
        }
        
        #warmup-screen .video-wrapper::before {
            content: '';
            position: absolute;
            top: -3px; left: -3px;
            width: calc(100% + 6px);
            height: calc(100% + 6px);
            background: linear-gradient(45deg, #a6e4b6, #fde68a, #a2d2ff, #ffc8dd, #a6e4b6);
            background-size: 400% 400%;
            border-radius: 2rem;
            z-index: 0;
            animation: animate-border 12s linear infinite;
        }

        #warmup-screen .welcome-video {
            width: 100%;
            height: auto;
            display: block;
            border-radius: calc(2rem - 3px);
            position: relative;
            z-index: 1;
            filter: blur(4px) brightness(0.7);
            transition: filter 0.5s ease-in-out;
        }
        #warmup-screen .video-wrapper.is-playing .welcome-video { filter: none; }
        
        #warmup-screen .play-button {
            position: absolute;
            z-index: 10;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
            border: 2px solid rgba(255, 255, 255, 0.9);
            padding: 0.8rem 1.8rem;
            font-size: 1.1rem;
            font-weight: 600;
            color: #3d4f63;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        #warmup-screen .play-button::before { content: '▶'; font-size: 1.5rem; line-height: 1; }
        #warmup-screen .play-button:hover { transform: scale(1.05); box-shadow: 0 8px 20px rgba(0,0,0,0.25); }
        #warmup-screen .video-wrapper.is-playing .play-button { opacity: 0; pointer-events: none; }

        #warmup-screen .button-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem; 
            width: 100%;
            max-width: 400px; 
            margin-top: 1rem;
        }
        @media (min-width: 768px) {
             #warmup-screen .button-grid {
                grid-template-columns: repeat(2, 1fr);
                max-width: 700px;
             }
        }
        @media (min-width: 1200px) {
             #warmup-screen .button-grid {
                grid-template-columns: repeat(4, 1fr);
                max-width: 1300px;
             }
        }

        #warmup-screen .game-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px; 
            padding: 1.1rem;
            border-radius: 1.5rem; 
            border: none;
            font-family: 'Fredoka', sans-serif;
            font-size: clamp(1.1rem, 4vw, 1.2rem);
            font-weight: 500;
            color: #3d4f63;
            text-decoration: none;
            box-shadow: 0 8px 15px rgba(45, 55, 72, 0.1);
            transition: all 0.3s ease;
            background-size: 200% auto;
            cursor: pointer;
            opacity: 0;
            animation: popIn 0.6s 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;
        }
        #warmup-screen .game-button:nth-child(2) { animation-delay: 0.6s; }
        #warmup-screen .game-button:nth-child(3) { animation-delay: 0.7s; }
        #warmup-screen .game-button:nth-child(4) { animation-delay: 0.8s; }
        #warmup-screen .game-button:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 12px 25px rgba(45, 55, 72, 0.15);
            background-position: right center; 
        }
        #warmup-screen .button-icon {
            width: 44px;
            height: 44px; 
            filter: drop-shadow(0px 2px 3px rgba(0,0,0,0.2));
            transition: transform 0.3s ease;
        }
        #warmup-screen .game-button:hover .button-icon { transform: scale(1.1) rotate(-8deg); }

        #warmup-screen .btn-1 { background-image: linear-gradient(to right, #a2d2ff, #bde0fe 51%, #a2d2ff 100%); }
        #warmup-screen .btn-2 { background-image: linear-gradient(to right, #ffc8dd, #ffafcc 51%, #ffc8dd 100%); }
        #warmup-screen .btn-3 { background-image: linear-gradient(to right, #cdb4db, #caffbf 51%, #cdb4db 100%); }
        #warmup-screen .btn-4 { background-image: linear-gradient(to right, #fdffb6, #ffd6a5 51%, #fdffb6 100%); }

        #warmup-screen .footer-text { margin-top: 1rem; font-family: 'Nunito', sans-serif; font-size: 12px; color: #6d6d6d; opacity: 0.7; }

        /* --- Estilos Pantalla "Emoji Dice Challenge" --- */
        #dice-challenge-screen {
            font-family: 'Nunito', sans-serif;
            background-color: #FFF9E6;
            background-image: linear-gradient(to bottom, #fefae0 0%, #fde4cf 100%);
        }
        .dice-sub-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }
        #dice-screen-2 {
            justify-content: flex-start;
            padding-top: 1rem;
            padding-bottom: 1rem;
        }
        #dice-challenge-screen h1, #dice-challenge-screen h3 { font-family: 'Fredoka', sans-serif; }
        #dice-challenge-screen .pop-in { animation: popIn 0.4s ease-out forwards; }
        #dice-challenge-screen .emoji-shadow { text-shadow: 0 4px 10px rgba(0,0,0,0.15); }
        #dice-challenge-screen .video-container video { transition: filter 0.7s ease-in-out, transform 0.7s ease-in-out; transform: scale(1); }
        #dice-challenge-screen .video-is-blurred { filter: blur(12px); }
        #dice-challenge-screen .is-playing #reveal-button-dice { opacity: 0; pointer-events: none; }
        #dice-challenge-screen .progress-bar-inner { animation-name: countdown; animation-timing-function: linear; animation-fill-mode: forwards; animation-duration: var(--timer-duration, 90s); }

        /* --- Estilos Pantalla "This or That" --- */
        #this-or-that-screen {
            font-family: 'Nunito', sans-serif;
            background-color: #e6f3fa;
            background-image: 
                url('data:image/svg+xml;utf8,<svg width="50" height="50" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg"><circle fill="white" cx="25" cy="25" r="1" fill-opacity="0.1"></circle></svg>'),
                linear-gradient(to bottom, #e6f3fa, #d0eaf7);
        }
        #this-or-that-screen h1, #this-or-that-screen h2 {
            font-family: 'Fredoka', sans-serif;
        }
        #this-or-that-screen h1 {
            text-shadow: 3px 3px 0px rgba(255, 127, 80, 0.3);
        }
        #this-or-that-screen #speaking-icon, #this-or-that-screen #speaking-icon-game {
            animation: glow 2.5s ease-in-out infinite;
            display: inline-block;
        }
        #this-or-that-screen .card-animation { animation: pop-in-slide-up 0.6s ease-out forwards; }
        #this-or-that-screen .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
        }
        #this-or-that-screen .card:hover {
            transform: scale(1.05) translateY(-5px);
            box-shadow: 0 20px 30px rgba(0, 0, 0, 0.1);
        }
        #this-or-that-screen #tot-card1:hover { border-color: #C4B5FD; }
        #this-or-that-screen #tot-card2:hover { border-color: #67E8F9; }
        #this-or-that-screen .cartoon-or {
            font-family: 'Fredoka', sans-serif;
            background: linear-gradient(180deg, #6B7280, #4B5563);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.15));
        }
        #this-or-that-screen .video-blur {
            filter: blur(8px);
            transition: filter 0.5s ease-in-out;
        }
        
        /* --- Estilos Pantalla "Secret Message" --- */
        #secret-message-screen {
            font-family: 'Nunito', sans-serif;
            background-color: #E8D9FF;
            background-image: radial-gradient(circle, #f3e8ff 0%, #E8D9FF 70%, #e0cffc 100%);
        }
        #secret-message-screen h1, #secret-message-screen h3 { font-family: 'Fredoka', sans-serif; }
        #secret-message-screen .app-split-container {
            background-color: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-height: auto;
            max-height: none;
            overflow: visible;
        }
        @media (min-width: 1024px) { /* lg breakpoint */
            #secret-message-screen .app-split-container {
                min-height: calc(100vh - 2rem);
                max-height: calc(100vh - 2rem);
                overflow: hidden;
            }
        }
        #secret-message-screen .btn {
            border-width: 2px;
            box-shadow: 0 5px 0 0;
            transition: all 0.15s ease-in-out;
            border-radius: 0.75rem;
        }
        #secret-message-screen .btn:hover:not(:disabled) { transform: translateY(-3px) scale(1.02); box-shadow: 0 8px 0 0; }
        #secret-message-screen .btn:active:not(:disabled) { transform: translateY(5px); box-shadow: 0 0 0 0; }
        #secret-message-screen .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        #secret-message-screen .btn-pink { background-color: #FFE8F0; border-color: #FBCFE8; box-shadow-color: #F472B6; }
        #secret-message-screen .btn-lilac { background-color: #e9d5ff; border-color: #d8b4fe; box-shadow-color: #a855f7; color: #581c87; }
        #secret-message-screen .btn-lilac:hover:not(:disabled) { box-shadow-color: #a855f7; }
        #secret-message-screen .btn-speaker { background-color: #c4b5fd; border-color: #a78bfa; box-shadow-color: #7c3aed; }
        #secret-message-screen .btn-speaker:hover:not(:disabled) { box-shadow-color: #7c3aed; }
        #secret-message-screen .btn-yellow { background-color: #fef9c3; border-color: #fde047; box-shadow-color: #eab308; color: #854d0e; }
        #secret-message-screen .btn-yellow:hover:not(:disabled) { box-shadow-color: #eab308; }
        #secret-message-screen .btn-yellow:hover:not(:disabled) .lock-icon { transform: rotate(-15deg) scale(1.1); }
        #secret-message-screen .nav-btn {
            width: auto; height: 3.5rem; padding: 0.75rem 1.5rem; font-size: 1.125rem; font-weight: 700;
            display: flex; align-items: center; justify-content: center; gap: 0.5rem;
            border-radius: 0.75rem; box-shadow: 0 5px 0 0;
            text-transform: capitalize;
        }
        #secret-message-screen .nav-btn:hover:not(:disabled) { transform: translateY(-3px) scale(1.02); box-shadow: 0 8px 0 0; }
        #secret-message-screen .nav-btn:active:not(:disabled) { transform: translateY(5px); box-shadow: 0 0 0 0; }
        #secret-message-screen .tabs-container { background-color: rgba(232, 217, 255, 0.5); padding: 0.5rem; border-radius: 0.75rem; }
        #secret-message-screen .tab { transition: all 0.3s ease; border-radius: 0.5rem; font-weight: 700; }
        #secret-message-screen .tab-active { background-color: white; color: #86198F; box-shadow: 0 4px 10px -2px rgba(0,0,0,0.1); }
        #secret-message-screen .emoji-space { display: inline-block; width: 1rem; }
        #secret-message-screen .styled-input::placeholder { color: #a1a1aa; font-weight: 700; }
        #secret-message-screen .code-cell {
            background-color: white; border-radius: 0.75rem; padding: 0.75rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.25rem;
        }
        #secret-message-screen .code-cell:hover { transform: scale(1.05); box-shadow: 0 4px 8px rgba(0,0,0,0.1); z-index: 10; }
        #secret-message-screen #emoji-code-grid > .code-cell:nth-child(odd) { background-color: #faf5ff; }
        #secret-message-screen .key-sparkle { position: absolute; font-size: 2rem; animation: sparkle 0.7s ease-out forwards; opacity: 0; }
        #secret-message-screen .input-wrapper { position: relative; }
        #secret-message-screen .input-watermark {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: #e5e7eb; user-select: none; transition: opacity 0.3s ease; z-index: 0;
        }
        #secret-message-screen .input-watermark.hidden { opacity: 0; }
        #secret-message-screen #encode-input { position: relative; z-index: 1; background-color: transparent; }
        #secret-message-screen .flip-card {
            display: inline-block; vertical-align: top; background-color: transparent;
            width: 3.2rem; height: 3.2rem; margin: 0.2rem;
            perspective: 1000px; cursor: pointer; animation: bounceIn 0.5s ease forwards;
        }
        #secret-message-screen .flip-card-inner {
            position: relative; width: 100%; height: 100%;
            transition: transform 0.6s; transform-style: preserve-3d;
        }
        #secret-message-screen .flip-card.is-flipped .flip-card-inner { transform: rotateY(180deg); }
        #secret-message-screen .flip-card-front, #secret-message-screen .flip-card-back {
            position: absolute; width: 100%; height: 100%;
            -webkit-backface-visibility: hidden; backface-visibility: hidden;
            border-radius: 1rem; display: flex; align-items: center; justify-content: center;
            background-color: white; border: 2px solid #f3e8ff;
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.08); font-size: 2rem;
        }
        #secret-message-screen .flip-card-back { transform: rotateY(180deg); font-weight: 800; color: #86198F; }
        @media (min-width: 640px) { /* sm */
            #secret-message-screen .flip-card { width: 4.5rem; height: 4.5rem; margin: 0.3rem; }
            #secret-message-screen .flip-card-front, #secret-message-screen .flip-card-back { font-size: 3rem; border-radius: 1.25rem; }
        }
        @media (min-width: 1024px) { /* lg */
            #secret-message-screen .flip-card { width: 4.5rem; height: 4.5rem; margin: 0.25rem; }
            #secret-message-screen .flip-card-front, #secret-message-screen .flip-card-back { font-size: 3rem; border-radius: 1rem; }
        }
        #secret-message-screen .video-card {
            background-color: rgba(255, 255, 255, 0.6); backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 1.5rem;
            padding: 1rem; text-align: center;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            width: 100%; max-width: 450px; position: relative;
        }
        #secret-message-screen .video-container { position: relative; border-radius: 1rem; overflow: hidden; }
        #secret-message-screen #sm-intro-video { width: 100%; display: block; filter: blur(8px); transition: filter 0.5s ease; }
        #secret-message-screen #sm-intro-video.unblur { filter: blur(0px); }
        #secret-message-screen #watch-intro-btn { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        #secret-message-screen .intro-title { color: #772D8B; font-weight: 800; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        
        #secret-message-screen #game-ui-panel, #secret-message-screen #code-table-panel {
            overflow-y: visible; max-height: none; flex-shrink: 0;
        }
        @media (min-width: 768px) { /* md breakpoint */
            #secret-message-screen #game-ui-panel, #secret-message-screen #code-table-panel {
                overflow-y: auto; max-height: 100%; flex-shrink: 1;
            }
        }
        #secret-message-screen #emoji-code-grid { overflow-y: visible; flex-grow: 1; }
        @media (min-width: 768px) { /* md breakpoint */
            #secret-message-screen #emoji-code-grid { overflow-y: auto; }
        }
        
        /* --- Estilos Pantalla "Emoji Says" --- */
        #emoji-says-screen {
            font-family: 'Nunito', sans-serif;
            background-color: #fff8e1; 
            color: #d97706; /* text-orange-500 */
            padding: 0;
        }
        #emoji-says-screen h1 { font-family: 'Fredoka', sans-serif; }
        #emoji-says-screen .card {
            perspective: 1000px;
            transition: transform 0.2s ease-in-out;
            border-radius: 1.5rem; /* 24px */
            aspect-ratio: 3 / 4; 
        }
        #emoji-says-screen .card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        #emoji-says-screen .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        #emoji-says-screen .card.is-flipped .card-inner {
            transform: rotateY(180deg);
        }
        #emoji-says-screen .card-front, #emoji-says-screen .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: background-color 0.2s ease-in-out;
        }
        #emoji-says-screen .card-front {
            font-size: 2.5rem;
            text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;
        }
        #emoji-says-screen .card-back {
            transform: rotateY(180deg);
            padding: 0.75rem;
            font-size: 1.1rem;
        }
        @media (min-width: 768px) {
            #emoji-says-screen .card-front { font-size: 3.5rem; }
            #emoji-says-screen .card-back { font-size: 1.25rem; }
        }
        #emoji-says-screen #video-frame {
            border-radius: 2rem;
            animation: pulse-glow 3s infinite ease-in-out, pop-in 0.6s ease-out forwards;
        }
        @keyframes pulse-glow {
            0% { box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
            50% { box-shadow: 0 10px 25px rgba(0,0,0,0.15), 0 0 25px 8px rgba(255, 127, 127, 0.3); }
            100% { box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        }
        #emoji-says-screen .shimmer-button {
            position: relative;
            overflow: hidden;
        }
        #emoji-says-screen .shimmer-button::after {
            content: '';
            position: absolute;
            top: 0;
            transform: translateX(-100%);
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 3.5s infinite 1s;
        }
        @keyframes shimmer {
            100% { transform: translateX(100%); }
        }
        
        @keyframes sound-waves {
            0% { transform: scale(1); opacity: 0.7; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        #emoji-says-screen .sound-on-animated::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 9999px;
            border: 2px solid #FF7F7F;
            animation: sound-waves 1.5s infinite;
        }
        @keyframes wave-and-glow {
            0%, 100% {
                transform: rotate(0deg) scale(1);
                text-shadow: 0 0 5px rgba(252, 211, 77, 0.7);
            }
            25% {
                transform: rotate(10deg) scale(1.05);
            }
            50% {
                transform: rotate(0deg) scale(1.1);
                text-shadow: 0 0 15px rgba(252, 211, 77, 1);
            }
            75% {
                transform: rotate(-10deg) scale(1.05);
            }
        }
        #emoji-says-screen .waving-emoji {
            display: inline-block;
            animation: wave-and-glow 2.5s infinite ease-in-out;
        }
        @keyframes rocket-bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }
        #emoji-says-screen #es-start-game-btn:hover .rocket-emoji {
            animation: rocket-bounce 0.6s ease-in-out infinite;
        }
        #emoji-says-screen .rocket-emoji {
            display: inline-block; /* Ensure transform works */
        }
        #es-grid-screen .grid-header {
            width: 100%;
            background-color: #FFF1B6; /* Color de fondo de la sección del título */
            padding-top: 0.75rem; /* ~12px */
            padding-bottom: 0.75rem;
            text-align: center;
            position: relative;
        }
        #es-grid-screen .grid-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px; /* Altura de la barra superior */
            background-color: #FF7F7F; /* Color de la barra superior */
        }
        #es-action-screen #es-instruction-text {
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            color: #374151;
        }
    </style>
</head>
<body>

    <!-- Pantalla 1: Menú Principal -->
    <div id="warmup-screen" class="screen">
        <div class="main-container">
            <div class="title-container">
                <h1 class="main-title">Dados filosóficos</h1>
                <p class="subtitle">Elige un juego para comenzar</p>
            </div>
            <div class="video-wrapper">
                <video id="introVideo" class="welcome-video" playsinline preload="auto" muted>
                    <source src="https://github.com/TamaraLlorens/warmup-assets/raw/refs/heads/main/video%20emoji%20.mp4" type="video/mp4">
                    Tu navegador no soporta la etiqueta de vídeo.
                </video>
                <button id="playVideoButton" class="play-button">Play Welcome Video</button>
            </div>
            <div class="button-grid">
                <button id="go-to-dice-challenge-btn" class="game-button btn-1">
                    <img src="https://github.com/TamaraLlorens/warmup-assets/blob/main/emoji-dice.png?raw=true" alt="Icono de dado" class="button-icon">
                    Clásico
                </button>
                <button id="go-to-this-or-that-btn" class="game-button btn-2">
                    <img src="https://github.com/TamaraLlorens/warmup-assets/blob/main/emoji-arrow.png?raw=true" alt="Icono de flecha" class="button-icon">
                    Este o este
                </button>
                <button id="go-to-secret-message-btn" class="game-button btn-3">
                    <img src="https://github.com/TamaraLlorens/warmup-assets/blob/main/emoji-lock.png?raw=true" alt="Icono de candado" class="button-icon">
                    Mensaje secreto
                </button>
                <button id="go-to-emoji-says-btn" class="game-button btn-4">
                    <img src="https://github.com/TamaraLlorens/warmup-assets/blob/main/emoji-megaphone.png?raw=true" alt="Icono de megáfono" class="button-icon">
                    Emoji dice
                </button>
            </div>
        </div>
        <footer class="footer-text">© Tamara Llorens · Chromtastic Teacher</footer>
    </div>

    <!-- Pantalla 2: Emoji Dice Challenge -->
    <div id="dice-challenge-screen" class="screen hidden">
        <div id="dice-screen-1" class="dice-sub-screen">
            <main class="w-full max-w-md mx-auto text-center flex flex-col justify-center items-center">
                <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold uppercase text-[#FF6F61] mb-4" style="text-shadow: -2px -2px 0 #FFF9E6, 2px -2px 0 #FFF9E6, -2px 2px 0 #FFF9E6, 2px 2px 0 #FFF9E6, 4px 4px 10px rgba(0,0,0,0.1);">
                    Emoji Dice<br>Challenge
                </h1>
                <div class="bg-white p-2 sm:p-3 w-full relative video-card rounded-2xl shadow-lg">
                    <div id="video-wrapper-dice" class="relative rounded-xl overflow-hidden aspect-square bg-black video-container">
                        <video id="instructions-video-dice" class="w-full h-full object-cover video-is-blurred" src="https://cdn.jsdelivr.net/gh/TamaraLlorens/warmup-assets@main/emoji%20video%20dice%20app.mp4" playsinline controls></video>
                        <button id="reveal-button-dice" class="absolute inset-0 flex items-center justify-center w-full h-full bg-transparent">
                            <span class="bg-white/90 text-[#4A4A4A] text-lg font-bold py-3 px-6 rounded-xl shadow-md hover:scale-105 transition-transform">🎬 Watch Instructions</span>
                        </button>
                    </div>
                </div>
                <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mt-4">
                    <button id="dice-home-btn-1" class="bg-white text-gray-700 font-semibold text-lg rounded-xl flex items-center justify-center gap-2 transition-all duration-200 ease-in-out py-2 px-5 shadow-md hover:shadow-lg hover:transform hover:-translate-y-0.5 no-underline">
                        <span class="text-xl">🏠</span>
                        <span>Home</span>
                    </button>
                    <button id="start-challenge-btn" class="font-semibold text-lg rounded-xl flex items-center justify-center gap-2 transition-all duration-200 ease-in-out text-white py-2 px-6" style="background-image: linear-gradient(135deg, #FFC894 0%, #FF9A8B 100%); box-shadow: 0 4px 20px rgba(255, 154, 139, 0.35); ">
                        <span class="text-2xl">🎲</span>
                        <span>Start Challenge</span>
                    </button>
                </div>
            </main>
        </div>
        <div id="dice-screen-2" class="dice-sub-screen hidden">
            <div class="w-full max-w-5xl flex flex-col gap-4">
                <header class="text-center flex-shrink-0">
                    <h1 class="text-2xl sm:text-3xl md:text-4xl font-extrabold uppercase text-[#FF6F61]" style="text-shadow: -1px -1px 0 #FFF9E6, 1px -1px 0 #FFF9E6, -1px 1px 0 #FFF9E6, 1px 1px 0 #FFF9E6, 2px 2px 8px rgba(0,0,0,0.1);">Emoji Dice Challenge</h1>
                </header>
                <div class="p-3 rounded-2xl space-y-3 flex-shrink-0" style="background-color: #fff8f2; box-shadow: 0px 6px 12px rgba(0,0,0,0.06);">
                    <section>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                            <div class="flex flex-col"><label class="font-bold text-gray-700 mb-1 flex items-center gap-2 text-sm">🔸 <span class="mr-auto">Level</span></label><select id="level-select" class="w-full appearance-none rounded-xl border-0 bg-white shadow-sm px-3 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-amber-400"><option value="Classic">Classic 🔸</option><option value="Challenge">Challenge 🔺</option></select></div>
                            <div class="flex flex-col"><label class="font-bold text-gray-700 mb-1 flex items-center gap-2 text-sm">👥 <span class="mr-auto">Grouping</span></label><select id="grouping-select" class="w-full appearance-none rounded-xl border-0 bg-white shadow-sm px-3 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-amber-400"><option value="Individual">Individual 👤</option><option value="Pairs">Pairs 👥</option><option value="Group">Group 👨‍👩‍👧‍👦</option></select></div>
                            <div class="flex flex-col"><label class="font-bold text-gray-700 mb-1 flex items-center gap-2 text-sm">✍️ <span class="mr-auto">Skill</span></label><select id="skill-select" class="w-full appearance-none rounded-xl border-0 bg-white shadow-sm px-3 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-amber-400"><option value="Written">Written ✍️</option><option value="Oral">Oral 🗣️</option></select></div>
                        </div>
                    </section>
                    <section class="bg-white/60 rounded-xl p-2 flex flex-wrap items-center justify-center gap-3">
                        <div class="flex items-center gap-2"><label for="minutes">🕒</label><input type="number" id="minutes" value="1" min="0" max="59" class="w-14 p-1 rounded-md border border-gray-300 text-center"><span class="font-bold">:</span><input type="number" id="seconds" value="30" min="0" max="59" class="w-14 p-1 rounded-md border border-gray-300 text-center"></div>
                        <button id="start-timer-btn" class="py-1 px-3 rounded-xl shadow-md transition-all duration-300 ease-in-out text-gray-800 font-semibold hover:opacity-90 text-sm">🟢 Start</button>
                        <div id="timer-bar-container" class="hidden w-full bg-gray-200 rounded-full h-2 overflow-hidden"><div id="timer-bar" class="bg-gradient-to-r from-green-400 to-blue-500 h-2 w-full"></div></div>
                    </section>
                </div>
                <div class="flex flex-col md:flex-row gap-4 w-full">
                    <div id="emoji-main-block" class="w-full p-4 rounded-2xl space-y-4 flex flex-col" style="background-color: #eef4ff;">
                        <section class="flex flex-col items-center justify-center space-y-4 flex-grow">
                            <div id="emoji-display" class="grid grid-cols-3 gap-3 sm:gap-5 w-full max-w-xs sm:max-w-sm mx-auto"></div>
                            <div id="word-display-card" class="hidden rounded-xl shadow-lg px-4 py-2" style="background-color: #dcd6ff;"><span id="word-display" class="text-xl font-baloo text-white font-bold"></span></div>
                            <p id="consigna" class="font-baloo text-center text-gray-800 text-base sm:text-lg md:text-xl px-2 flex-grow flex items-center justify-center min-h-[3rem]"></p>
                            <button id="roll-dice-btn" class="group font-bold text-white py-3 px-6 sm:px-8 rounded-xl shadow-lg flex items-center justify-center gap-3 text-lg sm:text-xl focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-400 focus:ring-offset-gray-50 transition-all duration-300" style="background-image: linear-gradient(to right, #ff9a8b, #ff6a88);"><span class="text-2xl sm:text-3xl transition-transform duration-300 group-hover:rotate-45">🎲</span><span>Roll the Dice</span></button>
                        </section>
                    </div>
                    <div id="steps-container" class="w-full md:w-2/5"><section id="steps-section" class="p-4 bg-white/60 rounded-2xl h-full flex flex-col justify-between"></section></div>
                </div>
                <footer class="p-2 flex-shrink-0">
                    <div class="flex justify-center items-center gap-4">
                        <button id="back-btn" class="nav-btn bg-white font-bold text-[#4A4A4A] py-1 px-4 rounded-xl border border-gray-200 flex items-center justify-center gap-2 text-base transition-all">⬅️ Back</button>
                        <button id="dice-home-btn-2" class="nav-btn bg-white font-bold text-[#4A4A4A] py-1 px-4 rounded-xl border border-gray-200 flex items-center justify-center gap-2 text-base transition-all no-underline">🏠 Home</button>
                    </div>
                </footer>
            </div>
        </div>
    </div>
    
    <!-- Pantalla 3: This or That -->
    <div id="this-or-that-screen" class="screen hidden">
        <div id="tot-start-screen" class="w-full max-w-5xl mx-auto text-center flex flex-col justify-center items-center h-full gap-y-4 md:gap-y-6">
            <h1 class="text-6xl md:text-8xl lg:text-9xl font-black text-slate-700 tracking-tight flex items-center justify-center">
                This or That
                <span id="speaking-icon" class="ml-4 text-6xl md:text-8xl lg:text-9xl">🗣️</span>
            </h1>
            <div class="flex justify-center">
                <div id="videoContainer" class="relative w-full max-w-md lg:max-w-lg mx-auto rounded-2xl shadow-lg overflow-hidden">
                    <video id="tot-instruction-video" class="w-full border-4 border-white video-blur" playsinline>
                        <source src="https://github.com/TamaraLlorens/warmup-assets/raw/refs/heads/main/VIDEO%20EMOJI%20THIS%20OR%20THAT.MP4" type="video/mp4">
                        Tu navegador no soporta la etiqueta de vídeo.
                    </video>
                    <button id="tot-play-video-btn" class="absolute inset-0 flex items-center justify-center bg-black/20 backdrop-blur-sm transition-opacity duration-500 group">
                        <div class="flex items-center justify-center bg-gradient-to-br from-purple-400 to-indigo-400 text-white font-bold text-xl px-8 py-4 rounded-3xl shadow-2xl transform group-hover:scale-105 transition-transform duration-300 border-2 border-white/50">
                            <span class="mr-3 text-3xl">🎬</span>
                            Reveal the Instructions
                        </div>
                    </button>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row justify-center items-center gap-6 lg:gap-8">
                <button id="tot-home-btn" class="flex items-center justify-center bg-sky-400 text-white font-bold text-xl px-8 py-4 rounded-3xl shadow-lg border-2 border-white/50 hover:bg-sky-500 transition-all duration-300 transform hover:scale-105 active:scale-95">
                    <span class="mr-3 text-2xl">🏠</span>
                    Home
                </button>
                <button id="tot-start-game-btn" class="flex items-center justify-center text-white font-bold text-xl px-8 py-4 rounded-3xl shadow-xl border-2 border-white/50 transition-all duration-300 transform hover:scale-105 active:scale-95 focus:outline-none" style="background-color: #F68AB8;">
                    <span class="mr-3 text-2xl">▶️</span>
                    Start Game
                </button>
            </div>
        </div>
        <div id="tot-game-screen" class="hidden w-full max-w-7xl mx-auto text-center flex-col justify-around h-full">
            <audio id="tot-background-music" loop>
                <source src="https://github.com/TamaraLlorens/warmup-assets/raw/refs/heads/main/This%20or%20That,%20Kids!.mp3" type="audio/mpeg">
            </audio>
            <div>
                <h1 class="text-4xl md:text-6xl lg:text-7xl font-black text-slate-700 tracking-tight flex items-center justify-center">
                    This or That
                    <span id="speaking-icon-game" class="ml-4 text-5xl md:text-6xl lg:text-7xl">🗣️</span>
                </h1>
                <p class="mt-2 mb-4 lg:mb-6 text-xl md:text-2xl lg:text-3xl font-semibold" style="color: #666666;">
                    👆 Choose one and say why! 🎤 Let’s speak in English!
                </p>
            </div>
            <div id="cardsContainer" class="flex-grow flex flex-col sm:flex-row justify-center items-center gap-4 md:gap-8 lg:gap-12">
                <div id="tot-card1" class="card flex-1 bg-white p-4 lg:p-6 rounded-3xl shadow-lg flex flex-col justify-center items-center border-4 border-purple-200 w-full max-w-sm lg:max-w-md h-full">
                    <div id="tot-emoji1" class="text-7xl md:text-9xl lg:text-[9rem] mb-4 drop-shadow-lg"></div>
                    <h2 id="tot-text1" class="text-3xl md:text-4xl lg:text-5xl font-bold text-center" style="color: #333333;"></h2>
                </div>
                <div class="text-5xl md:text-7xl font-black text-slate-600 flex items-center justify-center px-2 cartoon-or">OR</div>
                <div id="tot-card2" class="card flex-1 bg-white p-4 lg:p-6 rounded-3xl shadow-lg flex flex-col justify-center items-center border-4 border-cyan-200 w-full max-w-sm lg:max-w-md h-full">
                    <div id="tot-emoji2" class="text-7xl md:text-9xl lg:text-[9rem] mb-4 drop-shadow-lg"></div>
                    <h2 id="tot-text2" class="text-3xl md:text-4xl lg:text-5xl font-bold text-center" style="color: #333333;"></h2>
                </div>
            </div>
            <div class="mt-6 lg:mt-8 flex flex-col sm:flex-row justify-center items-center gap-4 sm:gap-8">
                <button id="tot-back-btn" class="flex items-center justify-center bg-gray-400 text-white font-bold text-xl px-8 py-4 rounded-3xl shadow-2xl shadow-gray-500/30 border-2 border-white/50 hover:bg-gray-500 transition-all duration-300 transform hover:scale-105 active:scale-95">
                    <span class="mr-4 text-2xl">⬅️</span>
                    Back
                </button>
                <button id="tot-music-toggle-btn" class="flex items-center justify-center bg-white/80 text-slate-600 font-bold text-3xl w-16 h-16 rounded-3xl shadow-lg border-2 border-white/50 backdrop-blur-sm transition-transform hover:scale-110 active:scale-95">🔇</button>
                <button id="tot-new-challenge-btn" class="flex items-center justify-center text-white font-bold text-xl px-8 py-4 rounded-3xl shadow-2xl shadow-pink-500/40 border-2 border-white/50 transition-all duration-300 transform hover:scale-105 active:scale-95 focus:outline-none" style="background-color: #F68AB8;">
                    <span class="mr-4 text-3xl">✨</span>
                    New Challenge
                </button>
            </div>
        </div>
    </div>
    
    <!-- Pantalla 4: Secret Message -->
    <div id="secret-message-screen" class="screen hidden">
        <div id="sm-intro-screen" class="flex flex-col items-center justify-center">
            <div class="video-card">
                <h1 class="text-3xl sm:text-4xl md:text-5xl intro-title">Secret Emoji Message</h1>
                <p class="mt-2 text-purple-700">Become an English Spy!</p>
                <div class="video-container mt-4">
                    <video id="sm-intro-video" muted playsinline>
                        <source src="https://github.com/TamaraLlorens/warmup-assets/raw/refs/heads/main/emoji%20secret%20code%20video%20intro.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <button id="watch-intro-btn" class="py-2 px-4 text-base sm:py-3 sm:px-6 sm:text-lg rounded-xl font-bold btn btn-lilac flex items-center gap-2">
                        🔍 Watch Instructions
                    </button>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row gap-4 mt-4">
                 <button id="sm-home-btn-intro-main" class="py-3 px-6 text-lg sm:py-4 sm:px-8 sm:text-xl rounded-xl font-bold btn btn-pink flex items-center gap-2">
                    🏠 Home
                </button>
                <button id="start-mission-btn" class="py-3 px-6 text-lg sm:py-4 sm:px-8 sm:text-xl rounded-xl font-bold btn btn-lilac">
                    🔐 Start Your Secret Mission
                </button>
            </div>
        </div>

        <div id="main-app-container" class="hidden flex-col md:flex-row w-full max-w-6xl mx-auto gap-4 p-4 app-split-container">
            <!-- Left Panel: Game UI -->
            <div id="game-ui-panel" class="relative w-full rounded-2xl shadow-xl p-4 sm:p-8 lg:p-4 md:flex-1">
                <header class="text-center mb-6 pt-12 sm:pt-0 lg:pt-0">
                    <h1 class="text-3xl sm:text-4xl font-extrabold text-purple-800 tracking-wider">SECRET EMOJI MESSAGE</h1>
                    <p class="text-purple-600">Become an English Spy!</p>
                </header>
                <div class="tabs-container flex justify-center mb-8">
                    <button id="tab-decode" class="tab tab-active flex-1 py-2 px-4 flex items-center justify-center gap-2"><span class="text-xl sm:text-2xl">🕵️‍♂️</span> Decode</button>
                    <button id="tab-encode" class="tab flex-1 py-2 px-4 flex items-center justify-center gap-2"><span class="text-xl sm:text-2xl">✏️</span> Create</button>
                </div>
                <div id="decode-section">
                    <div id="level-selection-area" class="text-center p-4">
                        <h3 class="text-2xl font-bold text-purple-800 mb-4">Choose your level</h3>
                        <div class="flex flex-col sm:flex-row gap-4 justify-center">
                            <button id="level-easy-btn" class="py-3 px-6 rounded-xl font-bold text-lg btn btn-lilac">Easy (Words)</button>
                            <button id="level-hard-btn" class="py-3 px-6 rounded-xl font-bold text-lg btn btn-pink">Hard (Sentences)</button>
                        </div>
                    </div>
                    <div id="game-area" class="hidden">
                        <div class="relative text-center bg-purple-100 p-4 rounded-xl">
                            <div id="confetti-container" class="absolute top-0 left-1/2 -translate-x-1/2"></div>
                            <p class="font-bold text-purple-800 mb-2">Can you decode the message?</p>
                            <div id="secret-message-display" class="flex flex-wrap justify-center items-center min-h-[4.5rem] sm:min-h-[5.5rem] lg:min-h-[4rem]"></div>
                        </div>
                        <div class="mt-4 flex flex-col items-center gap-3">
                            <input type="text" id="decode-input" placeholder="Type the secret message…" class="w-full max-w-md p-3 text-center border-2 border-purple-300 rounded-full styled-input focus:ring-2 focus:ring-pink-400 focus:border-pink-400 transition">
                            <p id="feedback-message" class="h-6 text-lg font-bold">&nbsp;</p>
                        </div>
                        <div class="mt-4 grid grid-cols-2 gap-4 text-center">
                            <button id="check-btn" class="w-full py-3 px-4 rounded-xl font-bold text-lg text-purple-900 btn btn-lilac">✔️ Check!</button>
                            <button id="new-message-btn" class="w-full py-3 px-4 rounded-xl font-bold text-lg text-purple-900 btn btn-pink">🔄 New</button>
                            <button id="show-code-btn" class="w-full py-3 px-4 rounded-xl font-bold text-lg text-purple-900 btn btn-pink col-span-2 md:hidden">🕵️ Show Code</button>
                            <button id="read-aloud-btn" class="w-full py-3 px-4 rounded-xl font-bold text-lg text-purple-900 btn btn-speaker col-span-2 flex items-center justify-center gap-3"><span class="text-2xl sm:text-3xl">📢</span> Read it aloud</button>
                        </div>
                        <div class="text-center mt-4">
                            <button id="change-level-btn" class="text-purple-600 hover:text-purple-900 font-bold underline">Change Level</button>
                        </div>
                    </div>
                </div>
                <div id="encode-section" class="hidden">
                    <div id="encode-input-area" class="text-center">
                        <label for="encode-input" class="block font-bold text-purple-800 mb-2 flex items-center justify-center gap-2">Write your own secret message <span class="text-2xl">🔍</span></label>
                        <div class="input-wrapper mt-2">
                            <div id="input-watermark" class="input-watermark text-3xl sm:text-5xl">🕵️‍♂️ 🔎 💬</div>
                            <textarea id="encode-input" rows="3" placeholder="e.g., Hello friend" class="w-full p-3 border-4 border-purple-300 rounded-3xl styled-input focus:ring-2 focus:ring-yellow-400 focus:border-yellow-400 transition"></textarea>
                        </div>
                        <button id="encode-btn" class="btn btn-yellow mt-4 w-full max-w-sm py-3 px-4 rounded-xl font-bold text-lg flex items-center justify-center gap-3">
                            <span class="lock-icon text-3xl transition-transform">🔐</span>
                            Create Message
                        </button>
                    </div>
                    <div id="encode-reveal-area" class="hidden text-center">
                        <div class="bg-purple-100 p-6 rounded-xl">
                            <h3 class="text-2xl font-bold text-purple-800 mb-4">Awesome! Your secret emoji message is ready! 🥳</h3>
                            <div id="encoded-output" class="flex flex-wrap justify-center items-center min-h-[4.5rem] sm:min-h-[5.5rem] lg:min-h-[4rem]"></div>
                            <button id="back-to-create-btn" class="btn btn-pink mt-4 w-full max-w-xs py-3 px-4 rounded-xl font-bold text-lg">✍️ Create Another</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Right Panel: Emoji Code Table -->
            <div id="code-table-panel" class="w-full bg-white/80 rounded-2xl shadow-xl border-2 border-purple-300 p-4 lg:p-4 md:flex-1 flex-col">
                <div class="text-center mb-4 p-2 bg-purple-100 rounded-lg">
                    <h3 class="text-xl font-bold text-purple-800 flex items-center justify-center gap-2"><span>🗝️</span> Emoji Code</h3>
                    <p class="text-xs text-purple-500 mt-1"><span class="italic">Pssst… True spies always keep the code secret!</span> 😉</p>
                </div>
                <div id="emoji-code-grid" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-2 md:gap-3 flex-grow overflow-y-auto p-1"></div>
                <div class="mt-6 flex justify-center gap-4">
                    <button id="sm-home-btn" title="Back to Home" class="nav-btn btn-pink">
                        🏠 <span class="ml-1">Home</span>
                    </button>
                    <button id="sm-back-to-intro-btn" title="Back to Intro" class="nav-btn btn-lilac">
                        ⬅️ <span class="ml-1">Back</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Pantalla 5: Emoji Says -->
    <div id="emoji-says-screen" class="screen hidden flex flex-col w-full h-full">
        <div id="es-start-screen" class="screen flex flex-col items-center justify-center flex-grow p-4 max-w-screen-xl mx-auto w-full">
            <h1 class="text-5xl md:text-7xl font-bold text-[#FF7F7F] mb-3" style="text-shadow: -2px -2px 0 #FFF1B6, 2px -2px 0 #FFF1B6, -2px 2px 0 #FFF1B6, 2px 2px 0 #FFF1B6, 4px 4px 10px rgba(255, 127, 127, 0.3);">
                Emoji Says <span class="waving-emoji">👋</span>
            </h1>
            <p class="text-lg md:text-xl text-gray-600 mb-6">Are you ready for the Emoji challenge?</p>
            
            <div id="video-frame-wrapper" class="relative w-full max-w-xs sm:max-w-sm md:max-w-md mx-auto">
                <div id="video-frame" class="bg-gradient-to-b from-[#fff9d4] to-[#FFF1B6] p-2 md:p-3">
                    <div class="relative w-full aspect-square rounded-2xl overflow-hidden bg-orange-100">
                         <video id="es-instruction-video" class="w-full h-full object-cover" 
                                playsinline preload="metadata"
                                onerror="this.parentElement.innerHTML = '<div class=\'flex items-center justify-center h-full text-center text-red-500 p-4\'>Error: Could not load video.</div>';">
                            <source src="https://cdn.jsdelivr.net/gh/TamaraLlorens/warmup-assets@main/video%20emoji%20says.mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        <button id="es-play-video-btn" class="absolute inset-0 flex items-center justify-center bg-black/30 text-white backdrop-blur-sm cursor-pointer transition-opacity duration-300 hover:bg-black/50">
                            <div class="bg-[#fb7185] py-3 px-6 rounded-3xl shadow-xl flex items-center gap-3 shimmer-button">
                                <span class="text-2xl">🔎</span>
                                <span class="font-bold text-xl">Reveal Instructions</span>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
            <div class="mt-8 flex flex-wrap justify-center items-center gap-4">
                 <button id="es-home-btn" class="bg-white/80 text-gray-700 font-bold text-xl py-4 px-8 rounded-3xl shadow-md hover:bg-white transition-all duration-200 ease-in-out flex items-center gap-2 transform active:scale-95 hover:scale-105">
                    <span class="text-2xl">🏠</span>
                    <span>Home</span>
                </button>
                <button id="es-start-game-btn" class="bg-[#fb7185] text-white font-bold text-xl py-4 px-8 rounded-3xl shadow-xl hover:bg-[#f43f5e] transition-all duration-300 ease-in-out transform active:scale-95 hover:scale-105 shimmer-button flex items-center gap-3">
                    <span role="img" aria-hidden="true" class="rocket-emoji text-2xl">🚀</span>
                    <span>Start Game!</span>
                </button>
            </div>
        </div>

        <div id="es-grid-screen" class="hidden flex-col w-full h-full p-0">
            <div class="grid-header flex-shrink-0">
                <h1 id="es-grid-title" class="text-4xl md:text-5xl font-bold text-[#FF7F7F]">
                    Choose a card!
                </h1>
                <p class="text-md md:text-lg text-gray-600">Let's see what's behind each card!</p>
            </div>

            <div class="flex-grow flex flex-col items-center justify-center p-2 md:p-4 w-full overflow-y-auto">
                <div id="es-card-grid" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-3 md:gap-4 w-full max-w-6xl">
                    <!-- Cards will be generated by JavaScript -->
                </div>
            </div>
            
            <div class="flex-shrink-0 w-full flex justify-center items-center gap-4 sm:gap-6 p-4">
                <button id="es-back-to-start-btn" class="bg-white/80 text-gray-700 font-bold text-lg sm:text-xl py-3 px-6 rounded-xl shadow-md hover:bg-white transition-all duration-200 ease-in-out flex items-center gap-2 transform active:scale-95 hover:scale-105">
                    <span class="text-2xl">⬅️</span>
                    <span>Back</span>
                </button>
                <button id="es-home-btn-grid" class="bg-[#FFF1B6] text-amber-700 font-bold text-lg sm:text-xl py-3 px-6 rounded-xl shadow-md hover:bg-[#fff9d4] transition-all duration-300 ease-in-out flex items-center gap-2 transform active:scale-95 hover:scale-105 no-underline">
                    <span class="text-2xl">🏠</span>
                    <span>Home</span>
                </button>
                <button id="es-reset-btn" class="bg-[#fb7185] text-white font-bold text-lg sm:text-xl py-3 px-6 rounded-xl shadow-md hover:bg-[#f43f5e] transition-all duration-300 ease-in-out hidden items-center gap-2 transform active:scale-95 hover:scale-105">
                    <span class="text-2xl">🔄</span>
                    <span>Reset</span>
                </button>
                <button id="es-mute-btn-grid" class="bg-white/70 text-orange-700 p-4 rounded-full shadow-md hover:bg-white transition-colors focus:outline-none relative transform hover:scale-110 active:scale-95">
                </button>
            </div>
        </div>
    </div>

    <div id="es-action-screen" class="hidden fixed inset-0 bg-black/60 backdrop-blur-md flex items-center justify-center p-4 z-50">
        <div class="bg-white/95 rounded-2xl shadow-2xl p-6 md:p-8 w-full max-w-lg text-center flex flex-col items-center gap-6">
            <p id="es-instruction-text" class="text-3xl md:text-5xl min-h-[100px] flex items-center justify-center"></p>
            <button id="es-back-to-grid-btn" class="bg-[#fb7185] text-white font-bold text-xl py-3 px-8 rounded-3xl shadow-lg hover:bg-[#f43f5e] transition-all duration-300 ease-in-out transform active:scale-95">
                Back to Grid
            </button>
        </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- NAVEGACIÓN PRINCIPAL ---
        const warmupScreen = document.getElementById('warmup-screen');
        const diceChallengeScreen = document.getElementById('dice-challenge-screen');
        const thisOrThatScreen = document.getElementById('this-or-that-screen');
        const secretMessageScreen = document.getElementById('secret-message-screen');
        const emojiSaysScreen = document.getElementById('emoji-says-screen');
        const allScreens = [warmupScreen, diceChallengeScreen, thisOrThatScreen, secretMessageScreen, emojiSaysScreen];

        const goToDiceChallengeBtn = document.getElementById('go-to-dice-challenge-btn');
        const goToThisOrThatBtn = document.getElementById('go-to-this-or-that-btn');
        const goToSecretMessageBtn = document.getElementById('go-to-secret-message-btn');
        const goToEmojiSaysBtn = document.getElementById('go-to-emoji-says-btn');
        
        function showScreen(screenToShow) {
            allScreens.forEach(screen => screen.classList.add('hidden'));
            screenToShow.classList.remove('hidden');
        }

        const goHome = () => showScreen(warmupScreen);

        // --- SCRIPT PANTALLA DE INICIO (WARMUP) ---
        const videoWrapper = document.querySelector('#warmup-screen .video-wrapper');
        const introVideo = document.getElementById('introVideo');
        const playButton = document.getElementById('playVideoButton');
        let audioInitialized = false;
        let popSynth;

        function initializeAudio() {
            if (audioInitialized) return;
            Tone.start();
            popSynth = new Tone.Synth({
                oscillator: { type: 'sine' },
                envelope: { attack: 0.005, decay: 0.1, sustain: 0, release: 0.2 }
            }).toDestination();
            audioInitialized = true;
        };
        
        function stopIntroVideo() {
            introVideo.pause();
            introVideo.currentTime = 0;
            videoWrapper.classList.remove('is-playing');
        }

        function playSound() {
            if (!audioInitialized) initializeAudio();
            if (popSynth) {
                popSynth.triggerAttackRelease("G5", "32n");
            }
        }

        document.querySelectorAll('button, .game-button, .nav-btn, .tab, .code-cell, .card').forEach(btn => {
            btn.addEventListener('click', (e) => {
                // Excepciones: no reproducir sonido genérico si ya hay uno específico
                const id = e.currentTarget.id;
                const classList = e.currentTarget.classList;
                if (id === 'roll-dice-btn' || id === 'start-timer-btn' || classList.contains('card') || id === 'new-message-btn') {
                    // Estos tienen su propia lógica de sonido o no necesitan uno
                    return;
                }
                playSound();
            });
        });

        playButton.addEventListener('click', () => {
            initializeAudio();
            videoWrapper.classList.add('is-playing');
            introVideo.muted = false;
            introVideo.currentTime = 0;
            introVideo.play();
        });

        introVideo.addEventListener('ended', () => {
            videoWrapper.classList.remove('is-playing');
        });

        document.body.addEventListener('click', initializeAudio, { once: true });
        document.body.addEventListener('touchend', initializeAudio, { once: true });

        document.querySelectorAll('#warmup-screen .game-button').forEach(btn => {
            btn.addEventListener('click', stopIntroVideo);
        });


        // --- LÓGICA DEL JUEGO DE DADOS ---
        const diceGameManager = (() => {
            const screen1 = document.getElementById('dice-screen-1');
            const screen2 = document.getElementById('dice-screen-2');
            
            const homeBtn1 = document.getElementById('dice-home-btn-1');
            const homeBtn2 = document.getElementById('dice-home-btn-2');
            const startBtn = document.getElementById('start-challenge-btn');
            const backBtn = document.getElementById('back-btn');
            const instructionsVideo = document.getElementById('instructions-video-dice');
            let timerEndSynth;

            function initializeDiceAudio() {
                if (timerEndSynth) return;
                timerEndSynth = new Tone.Synth({
                    oscillator: { type: 'triangle' },
                    envelope: { attack: 0.01, decay: 0.5, sustain: 0.1, release: 1 }
                }).toDestination();
            }

            function stopDiceVideo() {
                instructionsVideo.pause();
                instructionsVideo.currentTime = 0;
            }

            function showSubScreen(screenToShow) {
                screen1.classList.add('hidden');
                screen2.classList.add('hidden');
                screenToShow.classList.remove('hidden');
            }

            goToDiceChallengeBtn.addEventListener('click', () => {
                initializeDiceAudio();
                showSubScreen(screen1);
                showScreen(diceChallengeScreen);
            });

            homeBtn1.addEventListener('click', () => {
                stopDiceVideo();
                goHome();
            });
            homeBtn2.addEventListener('click', () => {
                stopDiceVideo();
                goHome();
            });
            
            startBtn.addEventListener('click', () => {
                stopDiceVideo();
                resetGame(); 
                showSubScreen(screen2);
            });
            
            backBtn.addEventListener('click', () => showSubScreen(screen1));

            const rollDiceBtn = document.getElementById('roll-dice-btn');
            const emojiDisplay = document.getElementById('emoji-display');
            const consigna = document.getElementById('consigna');
            const levelSelect = document.getElementById('level-select');
            const groupingSelect = document.getElementById('grouping-select');
            const skillSelect = document.getElementById('skill-select');
            const wordDisplayCard = document.getElementById('word-display-card');
            const wordDisplay = document.getElementById('word-display');
            const revealButton = document.getElementById('reveal-button-dice');
            const videoWrapperDice = document.getElementById('video-wrapper-dice');
            const startTimerBtn = document.getElementById('start-timer-btn');
            const minutesInput = document.getElementById('minutes');
            const secondsInput = document.getElementById('seconds');
            const timerBarContainer = document.getElementById('timer-bar-container');
            const timerBar = document.getElementById('timer-bar');
            const stepsSection = document.getElementById('steps-section');
            const emojiMainBlock = document.getElementById('emoji-main-block');
            const stepsContainer = document.getElementById('steps-container');
            const rollSound = new Audio('https://github.com/TamaraLlorens/warmup-assets/raw/refs/heads/main/button_06-190439.mp3');
            
            const emojis = ['�', '😂', '😍', '🤔', '😎', '😢', '😡', '🥳', '🤯', '😴', '👍', '👎', '🙏', '💪', '👀', '🧠', '🐶', '🐱', '🐭', '🦊', '🐻', '🐼', '🐨', '🐯', '🦁', '🐮', '🐷', '🐸', '🐵', '🐔', '🐧', '🐦', '🐤', '🦆', '🦅', '🦉', '🦇', '🐺', '🐗', '🐴', '🦄', '🐝', '🐛', '🦋', '🐌', '🐞', '🐜', '⚽️', '🏀', '🏈', '⚾️', '🎾', '🏐', '🏉', '🎱', '🏓', '🏸', '🥅', '🏒', '🏑', '🏏', '⛳️', '🏹', '🎣', '🥊', '🥋', '🎽', '⛸', '🥌', '🛷', '🎿', '⛷', '🏂', '🏋️‍♀️', '🤼‍♀️', '🤸‍♀️', '🤺', '🤾‍♀️', '🏌️‍♀️', '🏇', '🏆', '🥇', '🥈', '🥉', '🎨', '🎬', '🎤', '🎧', '🎼', '🎹', '🥁', '🎷', '🎺', '🎸', '🎻', '🎮', '🧩', '🎭', '🚗', '✈️', '🚀', '🛸', '🚁', '⛵️', '🏰', '🏠', '❤️', '💔', '💯', '🔥', '✨', '⭐️', '⚡️', '☀️', '☁️', '🌈', '🌊', '🍔', '🍕', '🍟', '🎂', '🍭', '🍩', '🍪', '☕️', '⏰', '💡', '💰', '🔑', '🎁', '🎉'];
            const challengeWords = ['Think', 'Create', 'Write', 'Read', 'Jump', 'Run', 'Eat', 'Sleep', 'Play', 'Laugh', 'Dance', 'Fly', 'Swim', 'Talk', 'Listen', 'Look', 'See', 'Find', 'Give', 'Take', 'Help', 'Work', 'Try', 'Use', 'Open', 'Close', 'Start', 'Stop', 'Walk', 'Move', 'Change', 'Imagine', 'Share', 'Win', 'Build', 'Draw', 'Sing', 'Explore', 'Discover', 'Solve', 'Visit', 'Travel', 'Cook', 'Clean', 'Watch', 'Learn', 'And', 'But', 'So', 'Because', 'Then', 'After', 'Before', 'When', 'While', 'If', 'Or', 'Also', 'However', 'Although', 'Until', 'Happy', 'Sad', 'Big', 'Small', 'Fast', 'Slow', 'Red', 'Blue', 'Green', 'Yellow', 'Sunny', 'Rainy', 'Cloudy', 'Funny', 'Scary', 'Brave', 'Strong', 'Kind', 'Clever', 'Delicious', 'Beautiful', 'Amazing', 'Interesting', 'Boring', 'New', 'Old', 'Young', 'Loud', 'Quiet', 'Bright', 'Dark', 'Heavy', 'Light', 'Good', 'Bad', 'Excited', 'Tired', 'Angry', 'Hungry', 'Thirsty', 'Cold', 'Hot', 'Silly', 'Mysterious', 'Magical', 'Gigantic', 'Tiny', 'Sparkly', 'Colorful', 'Invisible', 'Super', 'Weird', 'Awesome', 'Fantastic', 'Excellent', 'Horrible', 'Wonderful', 'Peaceful', 'Noisy', 'Secret', 'Ancient', 'Modern', 'Future', 'Quickly', 'Slowly', 'Suddenly', 'Finally', 'Next', 'First', 'Inside', 'Outside', 'Above', 'Below', 'Near', 'Far'];
            const stepsData = [
                { title: "STEP 1/3: THINK 🧠", instructions: "Discuss your sentence ideas with your partner/group." },
                { title: "STEP 2/3: CREATE ✍️", instructions: "Write or say the sentence together." },
                { title: "STEP 3/3: SHARE 🎤", instructions: "Present your sentence to the class!" }
            ];
            let timerInterval;
            let currentStep = 1;

            const getRandomItem = (arr) => arr[Math.floor(Math.random() * arr.length)];
            const resetGame = () => {
                emojiDisplay.innerHTML = '<div class="col-span-3 text-center text-gray-400 p-8">Click "Roll the Dice" to start!</div>';
                consigna.textContent = '';
                wordDisplayCard.classList.add('hidden');
                resetTimer();
                resetSteps();
            };
            const updateButtonStyles = () => {
                startTimerBtn.style.backgroundImage = 'linear-gradient(to right, #aff1da, #bcf0d1)';
                if(document.getElementById('next-step-btn')) {
                    document.getElementById('next-step-btn').style.backgroundImage = 'linear-gradient(to right, #a2d2ff, #bde0fe)';
                }
            };
            
            revealButton.addEventListener('click', () => {
                videoWrapperDice.classList.add('is-playing');
                instructionsVideo.classList.remove('video-is-blurred');
                instructionsVideo.play();
            });
            instructionsVideo.addEventListener('pause', () => {
                 videoWrapperDice.classList.remove('is-playing');
                 instructionsVideo.classList.add('video-is-blurred');
            });

            rollDiceBtn.addEventListener('click', () => {
                rollSound.currentTime = 0;
                rollSound.play();
                emojiDisplay.innerHTML = '';
                wordDisplayCard.classList.add('hidden');
                const level = levelSelect.value;
                const skill = skillSelect.value;
                const article = skill.toLowerCase() === 'oral' ? 'an' : 'a';
                for (let i = 0; i < 3; i++) {
                    const emoji = getRandomItem(emojis);
                    const card = document.createElement('div');
                    card.className = 'bg-white rounded-2xl shadow-lg p-2 sm:p-4 flex items-center justify-center aspect-square pop-in';
                    card.style.animationDelay = `${i * 0.1}s`;
                    card.innerHTML = `<span class="text-5xl sm:text-7xl emoji-shadow">${emoji}</span>`;
                    emojiDisplay.appendChild(card);
                }
                if (level === 'Challenge') {
                    const challengeWord = getRandomItem(challengeWords);
                    wordDisplay.textContent = challengeWord;
                    wordDisplayCard.classList.remove('hidden');
                    consigna.textContent = `Use the 3 emojis and the word "${challengeWord}" to create ${article} ${skill.toLowerCase()} sentence.`;
                } else {
                    consigna.textContent = `Use the 3 emojis to create ${article} ${skill.toLowerCase()} sentence.`;
                }
                resetTimer();
                resetSteps();
            });

            function startTimer() {
                clearInterval(timerInterval);
                const totalSeconds = (parseInt(minutesInput.value) || 0) * 60 + (parseInt(secondsInput.value) || 0);
                if (totalSeconds <= 0) return;
                startTimerBtn.disabled = true;
                startTimerBtn.style.backgroundImage = '';
                startTimerBtn.style.backgroundColor = '#9ca3af';
                startTimerBtn.innerHTML = '⏳ In progress...';
                timerBarContainer.classList.remove('hidden');
                timerBar.classList.remove('progress-bar-inner');
                void timerBar.offsetWidth;
                timerBar.classList.add('progress-bar-inner');
                timerBar.style.setProperty('--timer-duration', `${totalSeconds}s`);
                let remaining = totalSeconds;
                timerInterval = setInterval(() => {
                    remaining--;
                    if (remaining < 0) {
                        clearInterval(timerInterval);
                        startTimerBtn.innerHTML = "🔔 Time's up!";
                        startTimerBtn.style.backgroundImage = '';
                        startTimerBtn.style.backgroundColor = '#ef4444';
                        if (timerEndSynth) {
                           timerEndSynth.triggerAttackRelease("C6", "8n");
                        }
                    }
                }, 1000);
            }
            
            function resetTimer() {
                clearInterval(timerInterval);
                startTimerBtn.disabled = false;
                updateButtonStyles();
                startTimerBtn.innerHTML = '🟢 Start';
                timerBarContainer.classList.add('hidden');
                timerBar.classList.remove('progress-bar-inner');
            }
            startTimerBtn.addEventListener('click', startTimer);
            
            function updateStepView() {
                const stepData = stepsData[currentStep - 1];
                const nextStepBtn = document.getElementById('next-step-btn');
                if (!stepData) {
                    stepsSection.classList.add('hidden');
                    return;
                }
                document.getElementById('step-title').innerHTML = stepData.title;
                document.getElementById('step-instructions').textContent = stepData.instructions;
                nextStepBtn.textContent = (currentStep === 3) ? '🎉 Finish!' : '➡️ Next Step';
            }

            function resetSteps() {
                currentStep = 1;
                if (groupingSelect.value === 'Individual') {
                    stepsContainer.classList.add('hidden');
                    emojiMainBlock.classList.remove('md:w-3/5');
                    emojiMainBlock.classList.add('w-full');
                } else {
                    stepsContainer.classList.remove('hidden');
                    emojiMainBlock.classList.remove('w-full');
                    emojiMainBlock.classList.add('md:w-3/5');
                    stepsSection.innerHTML = `
                        <div class="text-center"><h3 id="step-title" class="font-baloo text-2xl sm:text-3xl font-bold text-pink-600"></h3></div>
                        <div class="text-center flex-grow flex items-center justify-center p-2 min-h-[6rem]"><p id="step-instructions" class="text-gray-700 text-base sm:text-lg font-medium"></p></div>
                        <div class="flex justify-center"><button id="next-step-btn" class="py-2 px-6 rounded-xl shadow-md transition-all duration-300 ease-in-out text-white hover:opacity-90 font-semibold text-base"></button></div>`;
                    
                    document.getElementById('next-step-btn').addEventListener('click', () => {
                        if (currentStep < 3) {
                            currentStep++;
                            updateStepView();
                        } else {
                            stepsContainer.classList.add('hidden');
                            emojiMainBlock.classList.remove('md:w-3/5');
                            emojiMainBlock.classList.add('w-full');
                        }
                    });
                    updateButtonStyles();
                    updateStepView();
                }
            }

            [levelSelect, skillSelect, groupingSelect].forEach(el => el.addEventListener('change', () => {
                resetTimer();
                resetSteps();
            }));
        })();

        // --- SCRIPT JUEGO "THIS OR THAT" ---
        const thisOrThatGameManager = (() => {
            const startScreen = document.getElementById('tot-start-screen');
            const gameScreen = document.getElementById('tot-game-screen');
            
            const homeBtn = document.getElementById('tot-home-btn');
            const startGameBtn = document.getElementById('tot-start-game-btn');
            const backBtn = document.getElementById('tot-back-btn');
            
            const instructionVideo = document.getElementById('tot-instruction-video');
            const playVideoBtn = document.getElementById('tot-play-video-btn');
            const newChallengeBtn = document.getElementById('tot-new-challenge-btn');
            const musicToggleBtn = document.getElementById('tot-music-toggle-btn');
            const music = document.getElementById('tot-background-music');
            
            const card1 = document.getElementById('tot-card1');
            const card2 = document.getElementById('tot-card2');
            const emoji1 = document.getElementById('tot-emoji1');
            const text1 = document.getElementById('tot-text1');
            const emoji2 = document.getElementById('tot-emoji2');
            const text2 = document.getElementById('tot-text2');
            
            const comparisons = [ { option1: { text: 'Dragon', emoji: '🐉' }, option2: { text: 'Unicorn', emoji: '🦄' } }, { option1: { text: 'Pizza', emoji: '🍕' }, option2: { text: 'Burger', emoji: '🍔' } }, { option1: { text: 'Cat', emoji: '🐱' }, option2: { text: 'Dog', emoji: '🐶' } }, { option1: { text: 'Ice Cream', emoji: '🍦' }, option2: { text: 'Chocolate', emoji: '🍫' } }, { option1: { text: 'Summer', emoji: '☀️' }, option2: { text: 'Winter', emoji: '❄️' } }, { option1: { text: 'Book', emoji: '📚' }, option2: { text: 'Movie', emoji: '🎬' } }, { option1: { text: 'Ocean', emoji: '🌊' }, option2: { text: 'Forest', emoji: '🌳' } }, { option1: { text: 'Robot', emoji: '🤖' }, option2: { text: 'Alien', emoji: '👽' } }, { option1: { text: 'Train', emoji: '🚂' }, option2: { text: 'Plane', emoji: '✈️' } }, { option1: { text: 'Apple', emoji: '🍎' }, option2: { text: 'Banana', emoji: '🍌' } }, { option1: { text: 'Soccer', emoji: '⚽' }, option2: { text: 'Basketball', emoji: '🏀' } }, { option1: { text: 'Sunglasses', emoji: '🕶️' }, option2: { text: 'Hat', emoji: '🎩' } }, { option1: { text: 'Cake', emoji: '🎂' }, option2: { text: 'Donut', emoji: '🍩' } }, { option1: { text: 'Rainbow', emoji: '🌈' }, option2: { text: 'Star', emoji: '⭐' } }, { option1: { text: 'Pencil', emoji: '✏️' }, option2: { text: 'Paintbrush', emoji: '🖌️' } }, { option1: { text: 'Teddy Bear', emoji: '🧸' }, option2: { text: 'Toy Car', emoji: '🚗' } }, { option1: { text: 'Guitar', emoji: '🎸' }, option2: { text: 'Piano', emoji: '🎹' } }, { option1: { text: 'Pirate', emoji: '🏴‍☠️' }, option2: { text: 'Ninja', emoji: '🥷' } }, { option1: { text: 'Cheese', emoji: '🧀' }, option2: { text: 'Popcorn', emoji: '🍿' } }, { option1: { text: 'Dinosaur', emoji: '🦕' }, option2: { text: 'Monster', emoji: '👾' } }, { option1: { text: 'Ghost', emoji: '👻' }, option2: { text: 'Zombie', emoji: '🧟' } }, { option1: { text: 'Castle', emoji: '🏰' }, option2: { text: 'Spaceship', emoji: '🚀' } }, { option1: { text: 'Roller Coaster', emoji: '🎢' }, option2: { text: 'Slide', emoji: '🛝' } }, { option1: { text: 'Magic Wand', emoji: '🪄' }, option2: { text: 'Potion', emoji: '🧪' } }, { option1: { text: 'Camping', emoji: '⛺' }, option2: { text: 'Hotel', emoji: '🏨' } }, { option1: { text: 'Balloon', emoji: '🎈' }, option2: { text: 'Kite', emoji: '🪁' } }, { option1: { text: 'Sunflower', emoji: '🌻' }, option2: { text: 'Rose', emoji: '🌹' } }, { option1: { text: 'Panda', emoji: '🐼' }, option2: { text: 'Koala', emoji: '🐨' } }, { option1: { text: 'Candy', emoji: '🍬' }, option2: { text: 'Lollipop', emoji: '🍭' } }, { option1: { text: 'Watermelon', emoji: '🍉' }, option2: { text: 'Strawberry', emoji: '🍓' } }, { option1: { text: 'Elephant', emoji: '🐘' }, option2: { text: 'Giraffe', emoji: '🦒' } }, { option1: { text: 'Fire', emoji: '🔥' }, option2: { text: 'Water', emoji: '💧' } }, { option1: { text: 'Rocket', emoji: '🚀' }, option2: { text: 'Submarine', emoji: '🛸' } }, { option1: { text: 'Cookie', emoji: '🍪' }, option2: { text: 'Muffin', emoji: '🧁' } }, { option1: { text: 'Mountain', emoji: '⛰️' }, option2: { text: 'Beach', emoji: '🏖️' } }, { option1: { text: 'Superhero', emoji: '🦸' }, option2: { text: 'Wizard', emoji: '🧙' } }, { option1: { text: 'Puzzle', emoji: '🧩' }, option2: { text: 'Maze', emoji: '🔲' } }, { option1: { text: 'Trampoline', emoji: '🤸' }, option2: { text: 'Jump Rope', emoji: '🪢' } }, { option1: { text: 'Bike', emoji: '🚲' }, option2: { text: 'Skateboard', emoji: '🛹' } }, { option1: { text: 'Lightning', emoji: '⚡' }, option2: { text: 'Snowflake', emoji: '❄️' } }, { option1: { text: 'Bee', emoji: '🐝' }, option2: { text: 'Butterfly', emoji: '🦋' } }, { option1: { text: 'Lizard', emoji: '🦎' }, option2: { text: 'Frog', emoji: '🐸' } }, { option1: { text: 'Clock', emoji: '🕒' }, option2: { text: 'Calendar', emoji: '📅' } }, { option1: { text: 'Cloud', emoji: '☁️' }, option2: { text: 'Moon', emoji: '🌙' } }, { option1: { text: 'Backpack', emoji: '🎒' }, option2: { text: 'Suitcase', emoji: '🧳' } }, { option1: { text: 'Hamburger', emoji: '🍔' }, option2: { text: 'Hot Dog', emoji: '🌭' } }, { option1: { text: 'Robot', emoji: '🤖' }, option2: { text: 'Dinosaur', emoji: '🦖' } }, { option1: { text: 'Tooth', emoji: '🦷' }, option2: { text: 'Bone', emoji: '🦴' } }, { option1: { text: 'Owl', emoji: '🦉' }, option2: { text: 'Bat', emoji: '🦇' } }, { option1: { text: 'Car', emoji: '🚗' }, option2: { text: 'Motorcycle', emoji: '🏍️' } }, { option1: { text: 'Rainbow', emoji: '🌈' }, option2: { text: 'Volcano', emoji: '🌋' } }, { option1: { text: 'Fairy', emoji: '🧚' }, option2: { text: 'Mermaid', emoji: '🧜‍♀️' } }, { option1: { text: 'House', emoji: '🏠' }, option2: { text: 'Treehouse', emoji: '🌳' } }, { option1: { text: 'Bowling', emoji: '🎳' }, option2: { text: 'Darts', emoji: '🎯' } }, { option1: { text: 'Skate', emoji: '🛼' }, option2: { text: 'Scooter', emoji: '🛴' } }, { option1: { text: 'Marshmallow', emoji: '🍡' }, option2: { text: 'Ice Cream', emoji: '🍨' } }, { option1: { text: 'Sandwich', emoji: '🥪' }, option2: { text: 'Taco', emoji: '🌮' } }, { option1: { text: 'Moon', emoji: '🌙' }, option2: { text: 'Sun', emoji: '☀️' } }, { option1: { text: 'Lion', emoji: '🦁' }, option2: { text: 'Tiger', emoji: '🐯' } }, { option1: { text: 'Spider', emoji: '🕷️' }, option2: { text: 'Ant', emoji: '🐜' } }, { option1: { text: 'Candy Cane', emoji: '🍭' }, option2: { text: 'Gingerbread Man', emoji: '🎄' } }, { option1: { text: 'Penguin', emoji: '🐧' }, option2: { text: 'Seal', emoji: '🦭' } }, { option1: { text: 'Elf', emoji: '🧝' }, option2: { text: 'Santa', emoji: '🎅' } }, { option1: { text: 'Cloud', emoji: '☁️' }, option2: { text: 'Rainbow', emoji: '🌈' } }, { option1: { text: 'Firetruck', emoji: '🚒' }, option2: { text: 'Police Car', emoji: '🚓' } }, { option1: { text: 'Wizard', emoji: '🧙' }, option2: { text: 'Dragon', emoji: '🐲' } }, { option1: { text: 'Fox', emoji: '🦊' }, option2: { text: 'Raccoon', emoji: '🦝' } }, { option1: { text: 'Crayon', emoji: '🖍️' }, option2: { text: 'Marker', emoji: '🖊️' } }, { option1: { text: 'Sunglasses', emoji: '🕶️' }, option2: { text: 'Umbrella', emoji: '☂️' } }, { option1: { text: 'Star', emoji: '⭐' }, option2: { text: 'Moon', emoji: '🌝' } }, { option1: { text: 'Popcorn', emoji: '🍿' }, option2: { text: 'Nachos', emoji: '🧀' } }, { option1: { text: 'Train', emoji: '🚂' }, option2: { text: 'Boat', emoji: '🚢' } }, { option1: { text: 'Gym', emoji: '🏋️' }, option2: { text: 'Park', emoji: '🛝' } }, { option1: { text: 'Cow', emoji: '🐄' }, option2: { text: 'Pig', emoji: '🐷' } }, { option1: { text: 'Corn', emoji: '🌽' }, option2: { text: 'Carrot', emoji: '🥕' } }, { option1: { text: 'Cupcake', emoji: '🧁' }, option2: { text: 'Pudding', emoji: '🍮' } }, { option1: { text: 'Milk', emoji: '🥛' }, option2: { text: 'Juice', emoji: '🧃' } }, { option1: { text: 'Snowman', emoji: '⛄' }, option2: { text: 'Reindeer', emoji: '🦌' } }, { option1: { text: 'Slippers', emoji: '🥿' }, option2: { text: 'Boots', emoji: '👢' } }, { option1: { text: 'Pillow', emoji: '💤' }, option2: { text: 'Blanket', emoji: '🧣' } }, { option1: { text: 'Sandwich', emoji: '🥪' }, option2: { text: 'Pizza', emoji: '🍕' } }, { option1: { text: 'Chicken', emoji: '🍗' }, option2: { text: 'Fish', emoji: '🐟' } }, { option1: { text: 'Jumping', emoji: '🤾' }, option2: { text: 'Running', emoji: '🏃' } }, { option1: { text: 'School', emoji: '🏫' }, option2: { text: 'Playground', emoji: '🛝' } }, { option1: { text: 'Pirate', emoji: '🏴‍☠️' }, option2: { text: 'Astronaut', emoji: '👨‍🚀' } }, { option1: { text: 'Bear', emoji: '🐻' }, option2: { text: 'Monkey', emoji: '🐒' } }, { option1: { text: 'Airplane', emoji: '✈️' }, option2: { text: 'Helicopter', emoji: '🚁' } }, { option1: { text: 'Painting', emoji: '🎨' }, option2: { text: 'Drawing', emoji: '✏️' } }, { option1: { text: 'Balloon', emoji: '🎈' }, option2: { text: 'Fireworks', emoji: '🎆' } }, { option1: { text: 'Starfish', emoji: '🌟' }, option2: { text: 'Crab', emoji: '🦀' } }, { option1: { text: 'Train', emoji: '🚆' }, option2: { text: 'Bus', emoji: '🚌' } }, { option1: { text: 'Ice Cream', emoji: '🍨' }, option2: { text: 'Popsicle', emoji: '🍧' } }, { option1: { text: 'Cave', emoji: '🕳️' }, option2: { text: 'Island', emoji: '🏝️' } }, { option1: { text: 'Gloves', emoji: '🧤' }, option2: { text: 'Hat', emoji: '🧢' } }, { option1: { text: 'Tennis', emoji: '🎾' }, option2: { text: 'Baseball', emoji: '⚾' } }, { option1: { text: 'Camera', emoji: '📸' }, option2: { text: 'Binoculars', emoji: '🔭' } }, { option1: { text: 'Music', emoji: '🎶' }, option2: { text: 'Dance', emoji: '💃' } }, { option1: { text: 'Water', emoji: '💧' }, option2: { text: 'Wind', emoji: '🌬️' } }, { option1: { text: 'Dragon', emoji: '🐲' }, option2: { text: 'Phoenix', emoji: '🔥' } }, { option1: { text: 'Rainbow', emoji: '🌈' }, option2: { text: 'Snowflake', emoji: '❄️' } } ];
            
            let usedCombinations = new Set();

            function showSubScreen(screenToShow) {
                startScreen.classList.add('hidden');
                gameScreen.classList.add('hidden');
                screenToShow.classList.remove('hidden');
            }

            function resetTotStartScreen() {
                showSubScreen(startScreen);
                music.pause();
                musicToggleBtn.textContent = '🔇';
                
                instructionVideo.pause();
                instructionVideo.currentTime = 0; 
                instructionVideo.classList.add('video-blur');
                playVideoBtn.classList.remove('opacity-0', 'pointer-events-none');
            }

            goToThisOrThatBtn.addEventListener('click', () => {
                resetTotStartScreen();
                showScreen(thisOrThatScreen);
            });

            homeBtn.addEventListener('click', () => {
                instructionVideo.pause(); 
                instructionVideo.currentTime = 0;
                music.pause();
                goHome();
            });

            startGameBtn.addEventListener('click', () => {
                instructionVideo.pause(); 
                usedCombinations.clear(); // Reiniciar el estado del juego
                showSubScreen(gameScreen);
                showNewChallenge();
                music.play().then(() => {
                    musicToggleBtn.textContent = '🔈';
                }).catch(error => {
                    musicToggleBtn.textContent = '🔇';
                });
            });

            backBtn.addEventListener('click', () => {
                resetTotStartScreen();
            });
            
            playVideoBtn.addEventListener('click', () => {
                instructionVideo.classList.remove('video-blur');
                playVideoBtn.classList.add('opacity-0', 'pointer-events-none');
                instructionVideo.play();
            });

            instructionVideo.addEventListener('ended', () => {
                instructionVideo.classList.add('video-blur');
                playVideoBtn.classList.remove('opacity-0', 'pointer-events-none');
            });
            
            newChallengeBtn.addEventListener('click', () => {
                showNewChallenge();
            });

            musicToggleBtn.addEventListener('click', () => {
                if (music.paused) {
                    music.play();
                    musicToggleBtn.textContent = '🔈';
                } else {
                    music.pause();
                    musicToggleBtn.textContent = '🔇';
                }
            });
            
            function showNewChallenge() {
                if (usedCombinations.size >= comparisons.length) {
                    usedCombinations.clear();
                }
                let challenge, combinationKey, randomIndex;
                do {
                    randomIndex = Math.floor(Math.random() * comparisons.length);
                    challenge = comparisons[randomIndex];
                    const names = [challenge.option1.text, challenge.option2.text].sort();
                    combinationKey = names.join('-');
                } while (usedCombinations.has(combinationKey));
                usedCombinations.add(combinationKey);

                emoji1.textContent = challenge.option1.emoji;
                text1.textContent = challenge.option1.text;
                emoji2.textContent = challenge.option2.emoji;
                text2.textContent = challenge.option2.text;

                [card1, card2].forEach(c => c.classList.remove('card-animation'));
                void card1.offsetWidth; 
                [card1, card2].forEach(c => c.classList.add('card-animation'));
            }
        })();

        // --- SCRIPT JUEGO "SECRET MESSAGE" ---
        const secretMessageManager = (() => {
            const introScreen = document.getElementById('sm-intro-screen');
            const mainAppContainer = document.getElementById('main-app-container');
            const watchIntroBtn = document.getElementById('watch-intro-btn');
            const startMissionBtn = document.getElementById('start-mission-btn');
            const homeBtnIntroMain = document.getElementById('sm-home-btn-intro-main');
            const introVideo = document.getElementById('sm-intro-video');
            const homeBtn = document.getElementById('sm-home-btn');
            const backToIntroBtn = document.getElementById('sm-back-to-intro-btn');
            
            function stopSmVideo() {
                introVideo.pause();
                introVideo.currentTime = 0;
            }

            const showIntro = () => {
                stopSmVideo();
                introVideo.classList.remove('unblur');
                watchIntroBtn.classList.remove('hidden');
                mainAppContainer.classList.add('hidden');
                introScreen.classList.remove('hidden');
                introScreen.classList.add('flex');
            };

            const hideIntro = () => {
                stopSmVideo();
                introScreen.classList.add('hidden');
                introScreen.classList.remove('flex');
                mainAppContainer.classList.remove('hidden');
                mainAppContainer.classList.add('flex');
                updateSecretMessageLayout();
            };
            
            goToSecretMessageBtn.addEventListener('click', () => {
                showScreen(secretMessageScreen);
                showIntro();
            });

            homeBtnIntroMain.addEventListener('click', () => {
                stopSmVideo();
                goHome();
            });
            homeBtn.addEventListener('click', () => {
                stopSmVideo();
                goHome();
            });
            startMissionBtn.addEventListener('click', hideIntro);
            backToIntroBtn.addEventListener('click', showIntro);

            const tabDecode = document.getElementById('tab-decode');
            const tabEncode = document.getElementById('tab-encode');
            const decodeSection = document.getElementById('decode-section');
            const encodeSection = document.getElementById('encode-section');
            const levelSelectionArea = document.getElementById('level-selection-area');
            const gameArea = document.getElementById('game-area');
            const levelEasyBtn = document.getElementById('level-easy-btn');
            const levelHardBtn = document.getElementById('level-hard-btn');
            const changeLevelBtn = document.getElementById('change-level-btn');
            const secretMessageDisplay = document.getElementById('secret-message-display');
            const decodeInput = document.getElementById('decode-input');
            const feedbackMessage = document.getElementById('feedback-message');
            const checkBtn = document.getElementById('check-btn');
            const newMessageBtn = document.getElementById('new-message-btn');
            const showCodeBtn = document.getElementById('show-code-btn');
            const readAloudBtn = document.getElementById('read-aloud-btn');
            const codeTablePanel = document.getElementById('code-table-panel');
            const emojiCodeGrid = document.getElementById('emoji-code-grid');
            const encodeInputArea = document.getElementById('encode-input-area');
            const encodeRevealArea = document.getElementById('encode-reveal-area');
            const encodeInput = document.getElementById('encode-input');
            const encodeBtn = document.getElementById('encode-btn');
            const encodedOutput = document.getElementById('encoded-output');
            const backToCreateBtn = document.getElementById('back-to-create-btn');
            const confettiContainer = document.getElementById('confetti-container');
            const inputWatermark = document.getElementById('input-watermark');
            const newMessageSound = new Audio('https://github.com/TamaraLlorens/warmup-assets/raw/refs/heads/main/button_06-190439.mp3');

            const EMOJI_CIPHER = { 'A': '🐶', 'B': '🍌', 'C': '🐱', 'D': '🦖', 'E': '🍎', 'F': '🐸', 'G': '🌈', 'H': '🐹', 'I': '🍦', 'J': '🎈', 'K': '🐨', 'L': '🍋', 'M': '🐵', 'N': '🍉', 'O': '🐙', 'P': '🐧', 'Q': '🧁', 'R': '🤖', 'S': '☀️', 'T': '🧸', 'U': '🦄', 'V': '🍇', 'W': '🐺', 'X': '❌', 'Y': '🌻', 'Z': '🦓' };
            const EMOJI_NAMES = { '🐶': 'dog', '🍌': 'banana', '🐱': 'cat', '🦖': 'dinosaur', '🍎': 'apple', '🐸': 'frog', '🌈': 'rainbow', '🐹': 'hamster', '🍦': 'ice cream', '🎈': 'balloon', '🐨': 'koala', '🍋': 'lemon', '🐵': 'monkey', '🍉': 'watermelon', '🐙': 'octopus', '🐧': 'penguin', '🧁': 'cupcake', '🤖': 'robot', '☀️': 'sun', '🧸': 'teddy bear', '🦄': 'unicorn', '🍇': 'grapes', '🐺': 'wolf', '❌': 'cross', '🌻': 'sunflower', '🦓': 'zebra' };
            const SECRET_WORDS = ["HELLO", "DOG", "CAT", "RED", "BLUE", "APPLE", "BANANA", "PIZZA", "HAPPY", "SUNNY", "ORANGE", "WATER", "FRIEND", "SCHOOL", "TEACHER", "STUDENT", "BOOK", "PENCIL", "HOME", "FAMILY", "LION", "TIGER", "MONKEY", "ELEPHANT", "GIRAFFE", "PENGUIN", "CHEESE", "BREAD", "JUICE", "CARROT", "CLASSROOM", "HOMEWORK", "READ", "WRITE", "PLAY", "EAT", "DRINK", "SLEEP", "JUMP", "RUN", "BIG", "SMALL", "FAST", "SLOW", "GOOD", "GREEN", "PURPLE", "BLACK", "WHITE", "PINK"];
            const SECRET_SENTENCES = ["GOOD MORNING", "I AM HAPPY", "IT IS SUNNY", "MY NAME IS ANNA", "SCHOOL IS COOL", "PLAY TIME", "GOOD JOB", "I LIKE PIZZA", "WHAT IS YOUR NAME", "SHE IS MY FRIEND", "HE IS READING A BOOK", "THEY ARE EATING LUNCH", "IT IS RAINING TODAY", "MY FAVORITE COLOR IS BLUE", "I HAVE A BIG FAMILY", "CAN YOU HELP ME", "WHERE ARE YOU FROM", "I GO TO SCHOOL BY BUS", "SHE LIKES TO DRAW", "HE CAN RUN FAST"];
            
            let currentSecretMessage = '';
            let currentLevel = '';

            const updateSecretMessageLayout = () => {
                const isMobile = window.innerWidth < 768; // Tailwind's 'md' breakpoint
                if (isMobile) {
                    showCodeBtn.classList.remove('hidden');
                    if (!codeTablePanel.dataset.toggled) {
                       codeTablePanel.classList.add('hidden');
                    }
                } else {
                    showCodeBtn.classList.add('hidden');
                    codeTablePanel.classList.remove('hidden');
                    codeTablePanel.classList.add('flex');
                }
            };

            window.addEventListener('resize', updateSecretMessageLayout);

            const initSpeech = () => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.getVoices();
                }
            };
            document.body.addEventListener('click', initSpeech, { once: true });
            document.body.addEventListener('touchstart', initSpeech, { once: true });

            const switchView = (view) => {
                const isDecode = view === 'decode';
                decodeSection.classList.toggle('hidden', !isDecode);
                encodeSection.classList.toggle('hidden', isDecode);
                tabDecode.classList.toggle('tab-active', isDecode);
                tabEncode.classList.toggle('tab-active', !isDecode);
                if (isDecode) {
                    showLevelSelection();
                }
            };

            const textToEmojiHTML = (text, container) => {
                container.innerHTML = '';
                for (const char of text.toUpperCase()) {
                    if (EMOJI_CIPHER[char]) {
                        const emoji = EMOJI_CIPHER[char];
                        const flipCard = document.createElement('div');
                        flipCard.className = 'flip-card';
                        flipCard.innerHTML = `
                            <div class="flip-card-inner">
                                <div class="flip-card-front">${emoji}</div>
                                <div class="flip-card-back">${char}</div>
                            </div>
                        `;
                        container.appendChild(flipCard);
                    } else if (char === ' ') {
                        const space = document.createElement('div');
                        space.className = 'emoji-space';
                        container.appendChild(space);
                    } else if (char.trim() !== '') {
                        const nonFlipCard = document.createElement('div');
                        nonFlipCard.className = 'flip-card';
                        nonFlipCard.innerHTML = `<div class="flip-card-inner"><div class="flip-card-front">${char}</div><div class="flip-card-back">${char}</div></div>`;
                        container.appendChild(nonFlipCard);
                    }
                }
            };
            
            const addFlipListener = (container) => {
                container.addEventListener('click', (e) => {
                    const flipCard = e.target.closest('.flip-card');
                    if (flipCard) {
                        flipCard.classList.toggle('is-flipped');
                    }
                });
            };

            const triggerConfetti = () => {
                confettiContainer.innerHTML = '';
                for (let i = 0; i < 30; i++) {
                    const confetti = document.createElement('div');
                    confetti.style.cssText = `position: absolute; width: 10px; height: 10px; background-color: hsl(${Math.random() * 360}, 100%, 50%); opacity: 0; animation: fall 3s ease-in-out forwards;`;
                    confetti.style.left = `${Math.random() * 100 - 50}px`;
                    confetti.style.animationDelay = `${Math.random() * 2}s`;
                    confettiContainer.appendChild(confetti);
                }
            };
            
            const generateNewMessageContent = () => {
                const sourceArray = currentLevel === 'easy' ? SECRET_WORDS : SECRET_SENTENCES;
                let newMessage;
                do {
                    newMessage = sourceArray[Math.floor(Math.random() * sourceArray.length)];
                } while (newMessage === currentSecretMessage && sourceArray.length > 1);

                currentSecretMessage = newMessage;
                textToEmojiHTML(currentSecretMessage, secretMessageDisplay);
                decodeInput.value = '';
                feedbackMessage.textContent = '\xa0';
            };

            const checkAnswer = () => {
                const userAnswer = decodeInput.value.trim().toUpperCase();
                if (userAnswer === currentSecretMessage) {
                    feedbackMessage.textContent = 'Correct! 🎉';
                    feedbackMessage.className = 'h-6 text-lg font-bold text-green-600';
                    triggerConfetti();
                } else {
                    feedbackMessage.textContent = 'Try again! 🤔';
                    feedbackMessage.className = 'h-6 text-lg font-bold text-red-600';
                }
            };
            
            const speak = (text) => {
                if (!('speechSynthesis' in window)) {
                    console.error("Sorry, your browser doesn't support text-to-speech.");
                    return;
                }
                const utterance = new SpeechSynthesisUtterance(text);
                const setVoiceAndSpeak = () => {
                    const voices = speechSynthesis.getVoices();
                    let selectedVoice = voices.find(voice => voice.name === 'Google US English');
                    if (!selectedVoice) selectedVoice = voices.find(voice => voice.lang === 'en-US' && !voice.localService);
                    if (!selectedVoice) selectedVoice = voices.find(voice => voice.lang === 'en-US');
                    if (selectedVoice) utterance.voice = selectedVoice;
                    
                    utterance.lang = 'en-US';
                    utterance.rate = 0.9;
                    utterance.pitch = 1;
                    window.speechSynthesis.cancel();
                    window.speechSynthesis.speak(utterance);
                };

                if (speechSynthesis.getVoices().length > 0) {
                    setVoiceAndSpeak();
                } else {
                    speechSynthesis.onvoiceschanged = setVoiceAndSpeak;
                }
            };

            const populateCodeTable = () => {
                emojiCodeGrid.innerHTML = '';
                const letters = Object.keys(EMOJI_CIPHER);
                
                letters.forEach(letter => {
                    const cell = document.createElement('div');
                    cell.className = 'code-cell';
                    cell.innerHTML = `<span class="font-bold text-lg md:text-xl">${letter}</span><span class="text-lg md:text-xl">=</span><span class="text-2xl md:text-3xl">${EMOJI_CIPHER[letter]}</span>`;
                    
                    cell.addEventListener('click', () => {
                        const emoji = EMOJI_CIPHER[letter];
                        const emojiName = EMOJI_NAMES[emoji] || 'emoji';
                        const textToSpeak = `${letter} is for ${emojiName}.`;
                        speak(textToSpeak);
                    });
                    emojiCodeGrid.appendChild(cell);
                });
            };

            // --- GAME LOGIC (CREATE) ---
            const createOwnMessage = () => {
                const textToEncode = encodeInput.value.trim();
                if (!textToEncode) return;
                textToEmojiHTML(textToEncode, encodedOutput);
                encodeInputArea.classList.add('hidden');
                encodeRevealArea.classList.remove('hidden');
            };
            
            const resetCreateView = () => {
                encodeRevealArea.classList.add('hidden');
                encodeInputArea.classList.remove('hidden');
                encodeInput.value = '';
                inputWatermark.classList.remove('hidden');
            };

            const showLevelSelection = () => {
                levelSelectionArea.classList.remove('hidden');
                gameArea.classList.add('hidden');
            };

            const startGame = (level) => {
                currentLevel = level;
                levelSelectionArea.classList.add('hidden');
                gameArea.classList.remove('hidden');
                generateNewMessageContent();
            };
            
            watchIntroBtn.addEventListener('click', () => {
                watchIntroBtn.classList.add('hidden');
                introVideo.classList.add('unblur');
                introVideo.muted = false;
                introVideo.currentTime = 0;
                introVideo.play();
            });

            tabDecode.addEventListener('click', () => switchView('decode'));
            tabEncode.addEventListener('click', () => switchView('encode'));
            levelEasyBtn.addEventListener('click', () => startGame('easy'));
            levelHardBtn.addEventListener('click', () => startGame('hard'));
            changeLevelBtn.addEventListener('click', showLevelSelection);
            
            if (showCodeBtn) {
                showCodeBtn.addEventListener('click', () => {
                    codeTablePanel.classList.toggle('hidden');
                    codeTablePanel.classList.toggle('flex');
                    codeTablePanel.dataset.toggled = !codeTablePanel.classList.contains('hidden');
                });
            }

            newMessageBtn.addEventListener('click', () => {
                newMessageSound.currentTime = 0;
                newMessageSound.play();
                generateNewMessageContent();
            });
            checkBtn.addEventListener('click', checkAnswer);
            decodeInput.addEventListener('keyup', (e) => { if (e.key === 'Enter') checkAnswer(); });
            readAloudBtn.addEventListener('click', () => { if(currentSecretMessage) speak(currentSecretMessage); });
            encodeBtn.addEventListener('click', createOwnMessage);
            backToCreateBtn.addEventListener('click', resetCreateView);
            encodeInput.addEventListener('input', () => {
                inputWatermark.classList.toggle('hidden', encodeInput.value.length > 0);
            });

            addFlipListener(secretMessageDisplay);
            addFlipListener(encodedOutput);
            populateCodeTable();
        })();

        // --- SCRIPT JUEGO "EMOJI SAYS" ---
        const emojiSaysManager = (() => {
            const startScreen = document.getElementById('es-start-screen');
            const gridScreen = document.getElementById('es-grid-screen');
            const actionScreen = document.getElementById('es-action-screen');
            const startGameBtn = document.getElementById('es-start-game-btn');
            const cardGrid = document.getElementById('es-card-grid');
            const instructionText = document.getElementById('es-instruction-text');
            const backToGridBtn = document.getElementById('es-back-to-grid-btn');
            const backToStartBtn = document.getElementById('es-back-to-start-btn');
            const homeBtnGrid = document.getElementById('es-home-btn-grid');
            const homeBtnStart = document.getElementById('es-home-btn');
            const resetBtn = document.getElementById('es-reset-btn');
            const muteBtnGrid = document.getElementById('es-mute-btn-grid');
            const video = document.getElementById('es-instruction-video');
            const playVideoBtn = document.getElementById('es-play-video-btn');
            const gridTitle = document.getElementById('es-grid-title');
            
            const soundOnIcon = `<span class="sound-on-animated"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg></span>`;
            const soundOffIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"></path></svg>`;

            const actionCategories = {
                corporales: [ { text: "jump up and down", emoji: "🤸" }, { text: "spin around", emoji: "💫" }, { text: "clap your hands", emoji: "👏" }, { text: "stomp your feet", emoji: "👣" }, { text: "march in place", emoji: "🚶" }, { text: "stretch your arms high", emoji: "🙌" }, { text: "touch your toes", emoji: "👇" }, { text: "pat your head", emoji: "💆" }, { text: "rub your tummy", emoji: "🖐️" }, { text: "wiggle your fingers", emoji: "👋" }, { text: "stand on one foot", emoji: "🧍" }, { text: "do a little dance", emoji: "💃" }, { text: "hop like a bunny", emoji: "🐰" }, { text: "stretch like a cat", emoji: "🐈" }, { text: "walk on your tiptoes", emoji: "🤫" }, { text: "make a muscle", emoji: "💪" } ],
                atencion: [ { text: "point to the door", emoji: "🚪" }, { text: "point to the window", emoji: "🪟" }, { text: "point to the ceiling", emoji: "👆" }, { text: "point to the floor", emoji: "👇" }, { text: "touch something blue", emoji: "🔵" }, { text: "touch something red", emoji: "🔴" }, { text: "touch something green", emoji: "🟢" }, { text: "touch something yellow", emoji: "🟡" }, { text: "touch your chair", emoji: "🪑" }, { text: "touch your desk", emoji: "✍️" }, { text: "open and close a book", emoji: "📖" }, { text: "pick up a pencil", emoji: "✏️" }, { text: "find something round", emoji: "🟠" }, { text: "point to your shoes", emoji: "👟" }, { text: "find the letter 'A' in the room", emoji: "🅰️" }, { text: "count to ten out loud", emoji: "🔟" } ],
                expresivas: [ { text: "nod your head 'yes'", emoji: "👍" }, { text: "shake your head 'no'", emoji: "👎" }, { text: "make a happy face", emoji: "😊" }, { text: "make a sad face", emoji: "😢" }, { text: "make a surprised face", emoji: "😮" }, { text: "make an angry face", emoji: "😠" }, { text: "make a silly face", emoji: "🤪" }, { text: "stick out your tongue", emoji: "😛" }, { text: "puff out your cheeks", emoji: "🐡" }, { text: "give a big yawn", emoji: "🥱" }, { text: "whisper your name", emoji: "🤫" }, { text: "laugh out loud", emoji: "😂" }, { text: "wink one eye", emoji: "😉" }, { text: "look very confused", emoji: "😕" }, { text: "pretend to be very cold", emoji: "🥶" }, { text: "pretend to smell something delicious", emoji: "😋" } ],
                creativas: [ { text: "act like a robot", emoji: "🤖" }, { text: "freeze like a statue", emoji: "🥶" }, { text: "melt like an ice cream", emoji: "🍦" }, { text: "grow like a flower", emoji: "🌷" }, { text: "pretend to play the guitar", emoji: "🎸" }, { text: "pretend to read a book", emoji: "📖" }, { text: "act like a superhero", emoji: "🦸" }, { text: "pretend to be a chef", emoji: "🧑‍🍳" }, { text: "pretend to brush your teeth", emoji: "🦷" }, { text: "pretend to climb a ladder", emoji: "🪜" }, { text: "act like you're sleeping", emoji: "😴" }, { text: "pretend to swim", emoji: "🏊" }, { text: "act like a T-Rex", emoji: "🦖" }, { text: "pretend to drive a race car", emoji: "🏎️" }, { text: "act like a monkey eating a banana", emoji: "🐒" }, { text: "pretend to be a wizard casting a spell", emoji: "🪄" } ]
            };
            
            let isMuted = false;
            let speechSynth = window.speechSynthesis;
            let voice;
            let shuffledActions = [];
            let masterActionDeck = [];
            let discardPile = [];
            const NUM_CARDS = 12;

            function showSubScreen(screenToShow) {
                startScreen.classList.add('hidden');
                gridScreen.classList.add('hidden');
                screenToShow.classList.remove('hidden');
                if (screenToShow === startScreen) {
                    startScreen.classList.add('flex');
                    gridScreen.classList.remove('flex');
                } else {
                    startScreen.classList.remove('flex');
                    gridScreen.classList.add('flex');
                }
            }

            const shuffleArray = (array) => {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            };

            const setVoice = () => {
                const voices = speechSynth.getVoices();
                if (voices.length === 0) return false;
                const voicePriority = ['Google US English', 'Microsoft Zira - English (United States)', 'Samantha', 'Alex'];
                for (const name of voicePriority) {
                    const foundVoice = voices.find(v => v.name === name);
                    if (foundVoice) { voice = foundVoice; break; }
                }
                if (!voice) { voice = voices.find(v => v.lang.startsWith('en-US')) || voices[0]; }
                return !!voice;
            };

            if (speechSynth.getVoices().length) {
                setVoice();
            } else {
                speechSynth.onvoiceschanged = setVoice;
            }

            const speak = (text) => {
                if (isMuted || !voice) return;
                speechSynth.cancel(); 
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.voice = voice;
                utterance.pitch = 1.3;
                utterance.rate = 1;
                utterance.volume = 1;
                speechSynth.speak(utterance);
            };

            const initializeDeck = () => {
                masterActionDeck = [];
                Object.values(actionCategories).forEach(category => {
                    masterActionDeck.push(...category);
                });
                shuffleArray(masterActionDeck);
                discardPile = [];
            };

            const createGrid = () => {
                cardGrid.innerHTML = '';
                
                if (masterActionDeck.length < NUM_CARDS) {
                    masterActionDeck.push(...discardPile);
                    discardPile = [];
                    shuffleArray(masterActionDeck);
                }

                const currentGameActions = masterActionDeck.splice(0, NUM_CARDS);
                discardPile.push(...currentGameActions);

                let finalGridActions = [];
                const half = NUM_CARDS / 2;

                for (let i = 0; i < currentGameActions.length; i++) {
                    const actionObject = currentGameActions[i];
                    let finalAction = {};

                    if (i < half) {
                        finalAction = {
                            displayText: `Emoji says… ${actionObject.text} ${actionObject.emoji}`,
                            speakText: `Emoji says… ${actionObject.text}`
                        };
                    } else {
                        finalAction = {
                            displayText: `${actionObject.text.charAt(0).toUpperCase() + actionObject.text.slice(1)} ${actionObject.emoji}`,
                            speakText: actionObject.text.charAt(0).toUpperCase() + actionObject.text.slice(1)
                        };
                    }
                    finalGridActions.push(finalAction);
                }

                shuffleArray(finalGridActions);
                shuffledActions = finalGridActions;

                for (let i = 0; i < NUM_CARDS; i++) {
                    const card = document.createElement('div');
                    card.className = 'card cursor-pointer'; 
                    card.dataset.index = i;
                    card.addEventListener('click', handleCardClick);

                    const cardInner = document.createElement('div');
                    cardInner.className = 'card-inner';

                    const cardFront = document.createElement('div');
                    const hue = 35 + (i % 6) * 4; 
                    cardFront.style.backgroundColor = `hsl(${hue}, 100%, 85%)`;
                    cardFront.className = 'card-front text-orange-600 hover:brightness-105';
                    cardFront.textContent = i + 1;

                    const cardBack = document.createElement('div');
                    cardBack.className = 'card-back bg-white/80 text-stone-800';
                    
                    cardInner.appendChild(cardFront);
                    cardInner.appendChild(cardBack);
                    card.appendChild(cardInner);
                    cardGrid.appendChild(card);
                }
                resetBtn.classList.add('hidden');
            };

            const handleCardClick = (e) => {
                const card = e.currentTarget;
                if (card.classList.contains('is-flipped')) return;
                
                const actionIndex = parseInt(card.dataset.index);
                const actionObject = shuffledActions[actionIndex];
                
                card.querySelector('.card-back').innerHTML = actionObject.displayText;
                card.classList.add('is-flipped');
                
                setTimeout(() => {
                    instructionText.innerHTML = actionObject.displayText;
                    speak(actionObject.speakText);
                    actionScreen.classList.remove('hidden');
                    actionScreen.style.opacity = '0';
                    actionScreen.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        actionScreen.style.transition = 'opacity 0.3s, transform 0.3s';
                        actionScreen.style.opacity = '1';
                        actionScreen.style.transform = 'scale(1)';
                    }, 10);
                }, 600);
            };

            const goToStartScreen = () => {
                video.pause();
                video.currentTime = 0;
                showSubScreen(startScreen);
            };
            
            backToGridBtn.addEventListener('click', () => {
                actionScreen.style.opacity = '0';
                actionScreen.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    actionScreen.classList.add('hidden');
                }, 300);
                
                const flippedCards = document.querySelectorAll('#es-card-grid .card.is-flipped').length;
                if (flippedCards === NUM_CARDS) {
                    gridTitle.textContent = "Good job!";
                    setTimeout(() => {
                        resetBtn.classList.remove('hidden');
                        resetBtn.classList.add('flex');
                    }, 500);
                }
            });

            resetBtn.addEventListener('click', () => {
                gridTitle.textContent = "Choose a card!";
                createGrid();
            });
            
            backToStartBtn.addEventListener('click', goToStartScreen);
            homeBtnGrid.addEventListener('click', () => {
                video.pause();
                video.currentTime = 0;
                goHome();
            });
            homeBtnStart.addEventListener('click', () => {
                video.pause();
                video.currentTime = 0;
                goHome();
            });


            const toggleMute = () => {
                isMuted = !isMuted;
                muteBtnGrid.innerHTML = isMuted ? soundOffIcon : soundOnIcon;
                if (isMuted) {
                    speechSynth.cancel();
                }
            };

            muteBtnGrid.addEventListener('click', toggleMute);
            muteBtnGrid.innerHTML = soundOnIcon;
            
            playVideoBtn.addEventListener('click', () => {
                video.play();
                playVideoBtn.classList.add('opacity-0', 'pointer-events-none');
            });

            video.addEventListener('ended', () => {
                playVideoBtn.classList.remove('opacity-0', 'pointer-events-none');
            });

            video.addEventListener('pause', () => {
                if (!video.ended) {
                    playVideoBtn.classList.remove('opacity-0', 'pointer-events-none');
                }
            });

            startGameBtn.addEventListener('click', () => {
                video.pause();
                video.currentTime = 0;
                playVideoBtn.classList.remove('opacity-0', 'pointer-events-none');
                showSubScreen(gridScreen);
                createGrid();
            });
            
            goToEmojiSaysBtn.addEventListener('click', () => {
                showSubScreen(startScreen);
                showScreen(emojiSaysScreen);
            });

            initializeDeck();
        })();
    });
    </script>
</body>
</html>
�
