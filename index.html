<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dados filos√≥ficos</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Poppins:wght@400;600&family=Nunito:wght@400;700;800&display=swap" rel="stylesheet"/>
  <style>
    :root{
      --brand-rose:#FF6F61;
      --brand-amber:#FFC894;
      --brand-rose-2:#FF9A8B;
      --bg-cream:#FFF9E6;
    }
    html,body{height:100%;width:100%;margin:0;padding:0}
    body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    .screen{
        width:100%;
        height:100vh;
        display:flex;
        flex-direction:column;
        align-items:center;
        justify-content:flex-start;
        padding:1rem;
        box-sizing:border-box;
        transition:opacity .3s ease-in-out
    }
    .hidden{display:none!important}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes popIn{0%{opacity:0;transform:scale(.8)}80%{opacity:1;transform:scale(1.05)}100%{opacity:1;transform:scale(1)}}
    @keyframes animate-border{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

    #warmup-screen{
        font-family:'Nunito',sans-serif;
        background:radial-gradient(circle at 50% 50%,#e6f7f3,#d0f0e8);
        color:#3d4f63;
        text-align:center;
        position:relative;
        overflow-y:auto;
        justify-content: center;
    }
    #warmup-screen .main-container{position:relative;z-index:1;width:100%;max-width:1300px;display:flex;flex-direction:column;align-items:center;gap:1rem;animation:fadeIn 1s ease-in-out}
    #warmup-screen .main-title{font-family:'Fredoka',sans-serif;font-size:clamp(2.5rem,8vw,3.2rem);font-weight:700;color:#E5989B;text-shadow:2px 2px 0 #fff,4px 4px 8px rgba(0,0,0,.1);margin:0;line-height:1.1}
    #warmup-screen .subtitle{font-size:clamp(1rem,4vw,1.1rem);font-weight:400;color:#5a6b80;margin-top:.25rem}
    #warmup-screen .button-grid{display:grid;grid-template-columns:1fr;gap:1rem;width:100%;max-width:400px;margin-top:1rem}
    @media (min-width:768px){#warmup-screen .button-grid{grid-template-columns:repeat(2,1fr);max-width:700px}}
    @media (min-width:1200px){#warmup-screen .button-grid{grid-template-columns:repeat(4,1fr);max-width:1300px}}
    #warmup-screen .game-button{display:flex;align-items:center;justify-content:center;gap:12px;padding:1.1rem;border-radius:1.5rem;border:none;font-family:'Fredoka',sans-serif;font-size:clamp(1.1rem,4vw,1.2rem);font-weight:500;color:#3d4f63;text-decoration:none;box-shadow:0 8px 15px rgba(45,55,72,.1);transition:all .3s ease;background-size:200% auto;cursor:pointer}
    #warmup-screen .game-button:hover{transform:translateY(-5px) scale(1.03);box-shadow:0 12px 25px rgba(45,55,72,.15);background-position:right center}
    #warmup-screen .button-icon{width:44px;height:44px;filter:drop-shadow(0 2px 3px rgba(0,0,0,.2));transition:transform .3s ease}
    #warmup-screen .game-button:hover .button-icon{transform:scale(1.1) rotate(-8deg)}
    #warmup-screen .btn-1{background-image:linear-gradient(to right,#a2d2ff,#bde0fe 51%,#a2d2ff 100%)}
    #warmup-screen .btn-2{background-image:linear-gradient(to right,#ffc8dd,#ffafcc 51%,#ffc8dd 100%)}
    #warmup-screen .btn-3{background-image:linear-gradient(to right,#cdb4db,#caffbf 51%,#cdb4db 100%)}
    #warmup-screen .btn-4{background-image:linear-gradient(to right,#fdffb6,#ffd6a5 51%,#fdffb6 100%)}
    #warmup-screen .footer-text{margin-top:1rem;font-family:'Nunito',sans-serif;font-size:12px;color:#6d6d6d;opacity:.7}

    #dice-challenge-screen, #emoji-dice-screen, #this-or-that-screen {font-family:'Nunito',sans-serif;background-color:var(--bg-cream);background-image:linear-gradient(to bottom,#fefae0 0%,#fde4cf 100%);position:relative;justify-content:flex-start}
    
    .screen-content-wrapper{width:100%;height:100%;overflow-y:auto;display:flex;flex-direction:column;align-items:center;justify-content:flex-start}
    .dice-sub-screen{display:flex;flex-direction:column;align-items:center; justify-content:flex-start;width:100%;min-height:100%;padding:1rem;box-sizing:border-box}
    #dice-challenge-screen h1, #emoji-dice-screen h1 {font-family:'Fredoka',sans-serif}
    .pop-in{animation:popIn .4s ease-out forwards}
    .emoji-shadow{text-shadow:0 4px 10px rgba(0,0,0,.15)}
    .quantity-btn{width:40px;height:40px;border-radius:50%;background-color:#ffc8dd;color:#c13a69;font-size:2rem;font-weight:700;border:none;cursor:pointer;line-height:1;transition:all .2s ease;box-shadow:0 4px 10px rgba(0,0,0,.1)}
    .quantity-btn:hover{transform:scale(1.1);background-color:#ffafcc}
    .quantity-btn:disabled{background-color:#e5e7eb;color:#9ca3af;cursor:not-allowed;transform:scale(1)}
    .dice-toggle-wrapper input[type="checkbox"]{display:none}
    .dice-toggle-label{display:flex;align-items:center;justify-content:center;gap:8px;padding:.75rem;border-radius:1rem;background-color:#e0e7ff;color:#4338ca;font-family:'Fredoka',sans-serif;font-weight:500;cursor:pointer;transition:all .2s ease-in-out;border:2px solid transparent;text-align:center}
    .dice-toggle-wrapper input[type="checkbox"]:hover + .dice-toggle-label{transform:scale(1.03);box-shadow:0 8px 15px rgba(45,55,72,.1)}
    .dice-toggle-wrapper input[type="checkbox"]:checked + .dice-toggle-label{background-color:#818cf8;color:#fff;border-color:#c7d2fe;box-shadow:0 0 15px 3px rgba(129,140,248,.4)}
    .dice-toggle-wrapper input[type="checkbox"]:disabled + .dice-toggle-label{background-color:#e5e7eb;color:#9ca3af;cursor:not-allowed;transform:none;box-shadow:none;opacity:.7}
    #dice-challenge-screen .grid-container{display:grid;grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(3,1fr);gap:.75rem;width:100%;max-width:400px;aspect-ratio:1/1;background-color:rgba(238,244,255,.7);padding:.75rem;border-radius:1.5rem;border:2px dashed #c7d2fe}
    #dice-challenge-screen .grid-container .pop-in{width:100%;height:100%;padding:.25rem;overflow:hidden;display:flex;align-items:center;justify-content:center}
    #dice-challenge-screen .grid-container .pop-in span{font-size:clamp(2rem,12vw,4rem);line-height:1}
    #dice-challenge-screen .grid-container .pop-in img{width:90%;height:90%;object-fit:contain}

    #history-panel{position:fixed;transition:transform .3s ease-in-out}
    #history-panel.is-open{transform:translateX(0)}
    @media (prefers-reduced-motion: reduce){.pop-in{animation:none}}
    
    #secret-message-screen {
        font-family: 'Nunito', sans-serif;
        background-color: #E8D9FF;
        background-image: radial-gradient(circle, #f3e8ff 0%, #E8D9FF 70%, #e0cffc 100%);
    }
    #secret-message-screen h1, #secret-message-screen h3 { font-family: 'Fredoka', sans-serif; }
    #secret-message-screen .app-split-container {
        background-color: rgba(255, 255, 255, 0.6);
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        min-height: auto;
        max-height: none;
        overflow: visible;
    }
    @media (min-width: 1024px) {
        #secret-message-screen .app-split-container {
            min-height: calc(100vh - 2rem);
            max-height: calc(100vh - 2rem);
            overflow: hidden;
        }
    }
    #secret-message-screen .btn {
        border-width: 2px;
        box-shadow: 0 5px 0 0;
        transition: all 0.15s ease-in-out;
        border-radius: 0.75rem;
    }
    #secret-message-screen .btn:hover:not(:disabled) { transform: translateY(-3px) scale(1.02); box-shadow: 0 8px 0 0; }
    #secret-message-screen .btn:active:not(:disabled) { transform: translateY(5px); box-shadow: 0 0 0 0; }
    #secret-message-screen .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    #secret-message-screen .btn-pink { background-color: #FFE8F0; border-color: #FBCFE8; box-shadow-color: #F472B6; }
    #secret-message-screen .btn-lilac { background-color: #e9d5ff; border-color: #d8b4fe; box-shadow-color: #a855f7; color: #581c87; }
    #secret-message-screen .btn-lilac:hover:not(:disabled) { box-shadow-color: #a855f7; }
    #secret-message-screen .btn-speaker { background-color: #c4b5fd; border-color: #a78bfa; box-shadow-color: #7c3aed; }
    #secret-message-screen .btn-speaker:hover:not(:disabled) { box-shadow-color: #7c3aed; }
    #secret-message-screen .btn-yellow { background-color: #fef9c3; border-color: #fde047; box-shadow-color: #eab308; color: #854d0e; }
    #secret-message-screen .btn-yellow:hover:not(:disabled) { box-shadow-color: #eab308; }
    #secret-message-screen .btn-yellow:hover:not(:disabled) .lock-icon { transform: rotate(-15deg) scale(1.1); }
    #secret-message-screen .nav-btn {
        width: auto; height: 3.5rem; padding: 0.75rem 1.5rem; font-size: 1.125rem; font-weight: 700;
        display: flex; align-items: center; justify-content: center; gap: 0.5rem;
        border-radius: 0.75rem; box-shadow: 0 5px 0 0;
        text-transform: capitalize;
    }
    #secret-message-screen .nav-btn:hover:not(:disabled) { transform: translateY(-3px) scale(1.02); box-shadow: 0 8px 0 0; }
    #secret-message-screen .nav-btn:active:not(:disabled) { transform: translateY(5px); box-shadow: 0 0 0 0; }
    #secret-message-screen .tabs-container { background-color: rgba(232, 217, 255, 0.5); padding: 0.5rem; border-radius: 0.75rem; }
    #secret-message-screen .tab { transition: all 0.3s ease; border-radius: 0.5rem; font-weight: 700; }
    #secret-message-screen .tab-active { background-color: white; color: #86198F; box-shadow: 0 4px 10px -2px rgba(0,0,0,0.1); }
    #secret-message-screen .emoji-space { display: inline-block; width: 1rem; }
    #secret-message-screen .styled-input::placeholder { color: #a1a1aa; font-weight: 700; }
    #secret-message-screen .code-cell {
        background-color: white; border-radius: 0.75rem; padding: 0.75rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: transform 0.2s ease, box-shadow 0.2s ease;
        cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.25rem;
    }
    #secret-message-screen .code-cell:hover { transform: scale(1.05); box-shadow: 0 4px 8px rgba(0,0,0,0.1); z-index: 10; }
    #secret-message-screen #emoji-code-grid > .code-cell:nth-child(odd) { background-color: #faf5ff; }
    #secret-message-screen .key-sparkle { position: absolute; font-size: 2rem; animation: sparkle 0.7s ease-out forwards; opacity: 0; }
    #secret-message-screen .input-wrapper { position: relative; }
    #secret-message-screen .input-watermark {
        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        color: #e5e7eb; user-select: none; transition: opacity 0.3s ease; z-index: 0;
    }
    #secret-message-screen .input-watermark.hidden { opacity: 0; }
    #secret-message-screen #encode-input { position: relative; z-index: 1; background-color: transparent; }
    #secret-message-screen .flip-card {
        display: inline-block; vertical-align: top; background-color: transparent;
        width: 3.2rem; height: 3.2rem; margin: 0.2rem;
        perspective: 1000px; cursor: pointer; animation: bounceIn 0.5s ease forwards;
    }
    #secret-message-screen .flip-card-inner {
        position: relative; width: 100%; height: 100%;
        transition: transform 0.6s; transform-style: preserve-3d;
    }
    #secret-message-screen .flip-card.is-flipped .flip-card-inner { transform: rotateY(180deg); }
    #secret-message-screen .flip-card-front, #secret-message-screen .flip-card-back {
        position: absolute; width: 100%; height: 100%;
        -webkit-backface-visibility: hidden; backface-visibility: hidden;
        border-radius: 1rem; display: flex; align-items: center; justify-content: center;
        background-color: white; border: 2px solid #f3e8ff;
        box-shadow: 0 6px 8px rgba(0, 0, 0, 0.08); font-size: 2rem;
    }
    #secret-message-screen .flip-card-back { transform: rotateY(180deg); font-weight: 800; color: #86198F; }
    @media (min-width: 640px) { /* sm */
        #secret-message-screen .flip-card { width: 4.5rem; height: 4.5rem; margin: 0.3rem; }
        #secret-message-screen .flip-card-front, #secret-message-screen .flip-card-back { font-size: 3rem; border-radius: 1.25rem; }
    }
    @media (min-width: 1024px) { /* lg */
        #secret-message-screen .flip-card { width: 4.5rem; height: 4.5rem; margin: 0.25rem; }
        #secret-message-screen .flip-card-front, #secret-message-screen .flip-card-back { font-size: 3rem; border-radius: 1rem; }
    }
    #secret-message-screen #game-ui-panel, #secret-message-screen #code-table-panel {
        overflow-y: visible; max-height: none; flex-shrink: 0;
    }
    @media (min-width: 768px) { /* md breakpoint */
        #secret-message-screen #game-ui-panel, #secret-message-screen #code-table-panel {
            overflow-y: auto; max-height: 100%; flex-shrink: 1;
        }
    }
    #secret-message-screen #emoji-code-grid { overflow-y: visible; flex-grow: 1; }
    @media (min-width: 768px) { /* md breakpoint */
        #secret-message-screen #emoji-code-grid { overflow-y: auto; }
    }
  </style>
</head>
<body>
  <!-- PANTALLA PRINCIPAL -->
  <div id="warmup-screen" class="screen">
    <div class="main-container">
      <div class="title-container">
        <h1 class="main-title">Dados filos√≥ficos</h1>
        <p class="subtitle">Elige un juego para comenzar</p>
      </div>
      <div class="button-grid">
        <button id="go-to-dice-challenge-btn" class="game-button btn-1">
          <img src="https://github.com/TamaraLlorens/warmup-assets/blob/main/emoji-dice.png?raw=true" alt="Icono de dado" class="button-icon"> Lanzar dados
        </button>
        <button id="go-to-this-or-that-btn" class="game-button btn-2">
          <img src="https://github.com/TamaraLlorens/warmup-assets/blob/main/emoji-arrow.png?raw=true" alt="Icono de flecha" class="button-icon"> ¬øCu√°l eliges?
        </button>
        <button id="go-to-secret-message-btn" class="game-button btn-3">
          <img src="https://github.com/TamaraLlorens/warmup-assets/blob/main/emoji-lock.png?raw=true" alt="Icono de candado" class="button-icon"> Mensaje secreto
        </button>
        <button id="go-to-emoji-says-btn" class="game-button btn-4">
          <img src="https://github.com/TamaraLlorens/warmup-assets/blob/main/emoji-megaphone.png?raw=true" alt="Icono de meg√°fono" class="button-icon"> Conceptos filos√≥ficos
        </button>
      </div>
    </div>
    <footer class="footer-text">Basado en emoji-warm-up-games de ¬© Tamara Llorens ¬∑ Chromtastic Teacher</footer>
  </div>

  <!-- JUEGO 1: DICE CHALLENGE (Lanzar dados) -->
  <div id="dice-challenge-screen" class="screen hidden">
    <div class="screen-content-wrapper">
      <div class="dice-sub-screen">
        <div class="w-full max-w-5xl flex flex-col items-center gap-4">
          <header class="text-center flex-shrink-0 pt-4">
            <h1 class="text-2xl sm:text-3xl md:text-4xl font-extrabold uppercase" style="color:var(--brand-rose);text-shadow:-1px -1px 0 #FFF9E6, 1px -1px 0 #FFF9E6, -1px 1px 0 #FFF9E6, 1px 1px 0 #FFF9E6, 2px 2px 8px rgba(0,0,0,0.1);">Crea tu Tirada</h1>
          </header>
          <div id="dice-config-panel" class="w-full p-4 rounded-2xl space-y-4" style="background-color:#fff8f2;box-shadow:0 6px 12px rgba(0,0,0,.06);">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="p-3 rounded-lg bg-white/70">
                <label class="font-bold text-gray-700 text-lg flex items-center justify-center gap-2"><span>1.</span> Dados al azar (Emojis)</label>
                <div id="random-dice-controls" class="flex items-center justify-center gap-4 mt-2">
                  <button id="btn-minus-random" class="quantity-btn" aria-label="Restar dado">-</button>
                  <span id="random-dice-display" class="text-3xl font-bold text-pink-500 w-16 text-center">3</span>
                  <button id="btn-plus-random" class="quantity-btn" aria-label="Sumar dado">+</button>
                </div>
              </div>
              <div class="p-3 rounded-lg bg-white/70 flex flex-col justify-center items-center">
                <h2 class="font-bold text-gray-700 text-lg">Total a lanzar</h2>
                <p id="total-dice-launch-display" class="text-3xl font-bold text-green-600">3 Dados</p>
              </div>
            </div>
            <div>
              <label class="font-bold text-gray-700 text-lg text-center block mb-2">2. Dados espec√≠ficos (Filos√≥ficos)</label>
              <div id="specific-dice-selection" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 p-2"></div>
            </div>
          </div>
          <div class="w-full p-4 rounded-2xl space-y-4 flex flex-col items-center">
            <div id="emoji-display" class="grid-container"></div>
            <div id="save-roll-section" class="hidden w-full max-w-md mt-4 flex flex-col sm:flex-row items-center gap-2">
              <input id="roll-name-input" type="text" placeholder="Ponle un nombre a tu tirada..." class="flex-grow p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400">
              <button id="save-roll-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg flex items-center gap-2"><span class="text-xl">üíæ</span> Guardar</button>
            </div>
            <p id="consigna" class="font-baloo text-center text-gray-800 text-lg md:text-xl px-2 min-h-[2rem]">¬°Configura tu tirada y pulsa ¬´Lanzar dados¬ª!</p>
            <button id="roll-dice-btn" class="group font-bold text-white py-3 px-8 rounded-xl shadow-lg flex items-center justify-center gap-3 text-xl focus:outline-none transition-all duration-300" style="background-image:linear-gradient(to right,#ff9a8b,#ff6a88);"><span class="text-3xl transition-transform duration-300 group-hover:rotate-45">üé≤</span><span>Lanzar dados</span></button>
          </div>
          <footer class="p-2 flex-shrink-0">
            <div class="flex justify-center items-center gap-4">
              <button id="toggle-history-btn" class="bg-white font-bold text-[#4A4A4A] py-2 px-5 rounded-xl border border-gray-200 flex items-center justify-center gap-2 text-base transition-all" aria-controls="history-panel" aria-expanded="false">üìñ Historial</button>
              <button id="dice-home-btn-2" class="bg-white font-bold text-[#4A4A4A] py-2 px-5 rounded-xl border border-gray-200 flex items-center justify-center gap-2 text-base transition-all no-underline">üè† Inicio</button>
            </div>
          </footer>
        </div>
      </div>
    </div>
  </div>

  <!-- JUEGO 2: THIS OR THAT (¬øCu√°l eliges?) -->
  <div id="this-or-that-screen" class="screen hidden">
    <div id="tot-game-screen" class="w-full max-w-7xl mx-auto text-center flex flex-col justify-around h-full">
        <audio id="tot-background-music" loop>
            <source src="https://github.com/TamaraLlorens/warmup-assets/raw/refs/heads/main/This%20or%20That,%20Kids!.mp3" type="audio/mpeg">
        </audio>
        <div>
            <h1 class="text-4xl md:text-6xl lg:text-7xl font-black text-slate-700 tracking-tight flex items-center justify-center">
                ¬øCu√°l eliges?
                <span id="speaking-icon-game" class="ml-4 text-5xl md:text-6xl lg:text-7xl">üó£Ô∏è</span>
            </h1>
            <p class="mt-2 mb-4 lg:mb-6 text-xl md:text-2xl lg:text-3xl font-semibold" style="color: #666666;">
                üëÜ Elige una de las dos opciones y explica por qu√© üé§
            </p>
        </div>
        <div id="cardsContainer" class="flex-grow flex flex-col sm:flex-row justify-center items-center gap-4 md:gap-8 lg:gap-12">
            <div id="tot-card1" class="card flex-1 bg-white p-4 lg:p-6 rounded-3xl shadow-lg flex flex-col justify-center items-center border-4 border-purple-200 w-full max-w-sm lg:max-w-md h-full">
                <div id="tot-emoji1" class="text-7xl md:text-9xl lg:text-[9rem] mb-4 drop-shadow-lg"></div>
                <h2 id="tot-text1" class="text-3xl md:text-4xl lg:text-5xl font-bold text-center" style="color: #333333;"></h2>
            </div>
            <div class="text-5xl md:text-7xl font-black text-slate-600 flex items-center justify-center px-2 cartoon-or">O</div>
            <div id="tot-card2" class="card flex-1 bg-white p-4 lg:p-6 rounded-3xl shadow-lg flex flex-col justify-center items-center border-4 border-cyan-200 w-full max-w-sm lg:max-w-md h-full">
                <div id="tot-emoji2" class="text-7xl md:text-9xl lg:text-[9rem] mb-4 drop-shadow-lg"></div>
                <h2 id="tot-text2" class="text-3xl md:text-4xl lg:text-5xl font-bold text-center" style="color: #333333;"></h2>
            </div>
        </div>
        <div class="mt-6 lg:mt-8 flex flex-col sm:flex-row justify-center items-center gap-4 sm:gap-8">
            <button id="tot-home-btn" class="flex items-center justify-center bg-gray-400 text-white font-bold text-xl px-8 py-4 rounded-3xl shadow-2xl shadow-gray-500/30 border-2 border-white/50 hover:bg-gray-500 transition-all duration-300 transform hover:scale-105 active:scale-95">
                <span class="mr-4 text-2xl">üè†</span>
                Inicio
            </button>
            <button id="tot-music-toggle-btn" class="flex items-center justify-center bg-white/80 text-slate-600 font-bold text-3xl w-16 h-16 rounded-3xl shadow-lg border-2 border-white/50 backdrop-blur-sm transition-transform hover:scale-110 active:scale-95">üîá</button>
            <button id="tot-new-challenge-btn" class="flex items-center justify-center text-white font-bold text-xl px-8 py-4 rounded-3xl shadow-2xl shadow-pink-500/40 border-2 border-white/50 transition-all duration-300 transform hover:scale-105 active:scale-95 focus:outline-none" style="background-color: #F68AB8;">
                <span class="mr-4 text-3xl">‚ú®</span>
                Nuevo Reto
            </button>
        </div>
    </div>
</div>

  <!-- JUEGO 3: EMOJI DICE (Conceptos filos√≥ficos) -->
  <div id="emoji-dice-screen" class="screen hidden">
    <div class="screen-content-wrapper">
        <main class="w-full max-w-4xl mx-auto text-center flex flex-col gap-4 p-4">
            <!-- T√≠tulo -->
            <header>
                <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold uppercase" style="color:var(--brand-rose);text-shadow:-2px -2px 0 #FFF9E6, 2px -2px 0 #FFF9E6, -2px 2px 0 #FFF9E6, 2px 2px 0 #FFF9E6, 4px 4px 10px rgba(0,0,0,.1);">Conceptos filos√≥ficos</h1>
                <h2 class="text-xl font-bold text-gray-600 mt-4">Selecciona las opciones de juego</h2>
            </header>

            <!-- Panel de Configuraci√≥n -->
            <section class="w-full bg-white/80 rounded-2xl shadow p-4 text-left space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="font-bold text-gray-700 text-sm flex items-center justify-center">üé≤ N¬∫ de emojis (3‚Äì9)</label>
                        <div id="ed-emoji-controls" class="flex items-center justify-center gap-4 mt-2">
                            <button id="ed-btn-minus" class="quantity-btn" aria-label="Restar emoji">-</button>
                            <span id="ed-emoji-count-display" class="text-3xl font-bold text-pink-500 w-16 text-center">3</span>
                            <button id="ed-btn-plus" class="quantity-btn" aria-label="Sumar emoji">+</button>
                        </div>
                    </div>
                    <div>
                        <label class="font-bold text-gray-700 text-sm">üë• Agrupaci√≥n</label>
                        <select id="ed-grouping-select" class="w-full rounded-xl border-0 bg-white shadow-sm px-3 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-amber-400">
                            <option value="Individual">Individual üë§</option>
                            <option value="Pairs">Parejas üë•</option>
                            <option value="Group">Grupo üë®‚Äçüë©‚Äçüëß‚Äçüë¶</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="font-bold text-gray-700 text-sm block mb-1">üìù Lista de palabras del reto (opcional)</label>
                    <p class="text-xs text-gray-600 mb-2">Una por l√≠nea o separadas por comas. Si lo dejas vac√≠o se usa la lista por defecto.</p>
                    <textarea id="ed-custom-words" rows="3" class="w-full rounded-xl border border-gray-200 p-3" placeholder="ej.: r√°pido\nmisterioso, espacio, saltar, brillante"></textarea>
                </div>
            </section>

            <!-- Bot√≥n de Acci√≥n Principal -->
            <div class="my-4 flex justify-center">
                 <button id="ed-roll-dice-btn" class="group font-bold text-white py-3 px-8 rounded-xl shadow-lg flex items-center justify-center gap-3 text-lg sm:text-xl focus:outline-none transition-all duration-300" style="background-image:linear-gradient(to right,#ff9a8b,#ff6a88);"><span class="text-2xl sm:text-3xl transition-transform duration-300 group-hover:rotate-45">üé≤</span><span>Tirar dados</span></button>
            </div>

            <!-- √Årea de Resultados y Pasos -->
            <div class="flex flex-col md:flex-row gap-4 w-full">
                <div id="ed-emoji-main-block" class="w-full p-4 rounded-2xl space-y-4 flex flex-col" style="background-color:#eef4ff;">
                    <section class="flex flex-col items-center justify-center space-y-4 flex-grow">
                        <div id="ed-emoji-display" class="grid gap-3 sm:gap-5 w-full max-w-2xl mx-auto" style="grid-template-columns:repeat(3,minmax(64px,1fr));">
                            <div class="text-center text-gray-400 p-6 col-span-3">Configura tu partida y pulsa ‚ÄúTirar dados‚Äù para empezar</div>
                        </div>
                        <div id="ed-word-display-card" class="hidden rounded-xl shadow-lg px-4 py-2 bg-[#dcd6ff]">
                            <span class="text-white font-bold">Palabra del reto: </span>
                            <span id="ed-word-display" class="text-white font-extrabold"></span>
                        </div>
                        <p id="ed-consigna" class="text-center text-gray-800 text-base sm:text-lg md:text-xl px-2 flex-grow flex items-center justify-center min-h-[3rem]"></p>
                    </section>
                </div>
                <div id="ed-steps-container" class="w-full md:w-2/5 hidden">
                    <section id="ed-steps-section" class="p-4 bg-white/60 rounded-2xl h-full flex flex-col justify-between"></section>
                </div>
            </div>

            <!-- Footer con bot√≥n de Inicio -->
            <footer class="p-2 mt-4">
                <div class="flex justify-center items-center gap-4">
                    <button id="ed-home-btn" class="bg-white font-bold text-[#4A4A4A] py-2 px-5 rounded-xl border border-gray-200 flex items-center justify-center gap-2 text-base transition-all no-underline">üè† Inicio</button>
                </div>
            </footer>
        </main>
    </div>
</div>

  <!-- Pantalla 4: Secret Message -->
  <div id="secret-message-screen" class="screen hidden">
      <div id="main-app-container" class="flex flex-col md:flex-row w-full max-w-6xl mx-auto gap-4 p-4 app-split-container">
          <!-- Left Panel: Game UI -->
          <div id="game-ui-panel" class="relative w-full rounded-2xl shadow-xl p-4 sm:p-8 lg:p-4 md:flex-1">
              <header class="text-center mb-6 pt-12 sm:pt-0 lg:pt-0">
                  <h1 class="text-3xl sm:text-4xl font-extrabold text-purple-800 tracking-wider">MENSAJE SECRETO</h1>
                  <p class="text-purple-600">¬°Adelante esp√≠a filos√≥fico!</p>
              </header>
              <div class="tabs-container flex justify-center mb-8">
                  <button id="tab-decode" class="tab tab-active flex-1 py-2 px-4 flex items-center justify-center gap-2"><span class="text-xl sm:text-2xl">üïµÔ∏è‚Äç‚ôÇÔ∏è</span> Descodifica</button>
                  <button id="tab-encode" class="tab flex-1 py-2 px-4 flex items-center justify-center gap-2"><span class="text-xl sm:text-2xl">‚úèÔ∏è</span> Crea un mensaje</button>
              </div>
              <div id="decode-section">
                  <div id="level-selection-area" class="text-center p-4">
                      <h3 class="text-2xl font-bold text-purple-800 mb-4">Elige el nivel de dificultad</h3>
                      <div class="flex flex-col sm:flex-row gap-4 justify-center">
                          <button id="level-easy-btn" class="py-3 px-6 rounded-xl font-bold text-lg btn btn-lilac">F√°cil (Autores)</button>
                          <button id="level-hard-btn" class="py-3 px-6 rounded-xl font-bold text-lg btn btn-pink">Dif√≠cil (Frases)</button>
                      </div>
                  </div>
                  <div id="game-area" class="hidden">
                      <div class="relative text-center bg-purple-100 p-4 rounded-xl">
                          <div id="confetti-container" class="absolute top-0 left-1/2 -translate-x-1/2"></div>
                          <p class="font-bold text-purple-800 mb-2">¬øPuedes descifrar este mensaje?</p>
                          <div id="secret-message-display" class="flex flex-wrap justify-center items-center min-h-[4.5rem] sm:min-h-[5.5rem] lg:min-h-[4rem]"></div>
                      </div>
                      <div class="mt-4 flex flex-col items-center gap-3">
                          <input type="text" id="decode-input" placeholder="Escribe aqu√≠ el mensaje secreto..." class="w-full max-w-md p-3 text-center border-2 border-purple-300 rounded-full styled-input focus:ring-2 focus:ring-pink-400 focus:border-pink-400 transition">
                          <p id="feedback-message" class="h-6 text-lg font-bold">&nbsp;</p>
                      </div>
                      <div class="mt-4 grid grid-cols-2 gap-4 text-center">
                          <button id="check-btn" class="w-full py-3 px-4 rounded-xl font-bold text-lg text-purple-900 btn btn-lilac">‚úîÔ∏è Comprueba</button>
                          <button id="new-message-btn" class="w-full py-3 px-4 rounded-xl font-bold text-lg text-purple-900 btn btn-pink">üîÑ Nuevo</button>
                          <button id="show-code-btn" class="w-full py-3 px-4 rounded-xl font-bold text-lg text-purple-900 btn btn-pink col-span-2 md:hidden">üïµÔ∏è Mostrar c√≥digo</button>
                      </div>
                      <div class="text-center mt-4">
                          <button id="change-level-btn" class="text-purple-600 hover:text-purple-900 font-bold underline">Cambia de nivel</button>
                      </div>
                  </div>
              </div>
              <div id="encode-section" class="hidden">
                  <div id="encode-input-area" class="text-center">
                      <label for="encode-input" class="block font-bold text-purple-800 mb-2 flex items-center justify-center gap-2">Escribe tu propio mensaje secreto <span class="text-2xl">üîç</span></label>
                      <div class="input-wrapper mt-2">
                          <div id="input-watermark" class="input-watermark text-3xl sm:text-5xl">üïµÔ∏è‚Äç‚ôÇÔ∏è üîé üí¨</div>
                          <textarea id="encode-input" rows="3" placeholder="Por ejemplo: Hola" class="w-full p-3 border-4 border-purple-300 rounded-3xl styled-input focus:ring-2 focus:ring-yellow-400 focus:border-yellow-400 transition"></textarea>
                      </div>
                      <button id="encode-btn" class="btn btn-yellow mt-4 w-full max-w-sm py-3 px-4 rounded-xl font-bold text-lg flex items-center justify-center gap-3">
                          <span class="lock-icon text-3xl transition-transform">üîê</span>
                          Crea un mensaje
                      </button>
                  </div>
                  <div id="encode-reveal-area" class="hidden text-center">
                      <div class="bg-purple-100 p-6 rounded-xl">
                          <h3 class="text-2xl font-bold text-purple-800 mb-4">¬°Genial! ¬°Tu mensaje secreto de emoji est√° listo! ü•≥</h3>
                          <div id="encoded-output" class="flex flex-wrap justify-center items-center min-h-[4.5rem] sm:min-h-[5.5rem] lg:min-h-[4rem]"></div>
                          <button id="back-to-create-btn" class="btn btn-pink mt-4 w-full max-w-xs py-3 px-4 rounded-xl font-bold text-lg">‚úçÔ∏è Crea otro</button>
                      </div>
                  </div>
              </div>
          </div>
          <!-- Right Panel: Emoji Code Table -->
          <div id="code-table-panel" class="w-full bg-white/80 rounded-2xl shadow-xl border-2 border-purple-300 p-4 lg:p-4 md:flex-1 flex-col">
              <div class="text-center mb-4 p-2 bg-purple-100 rounded-lg">
                  <h3 class="text-xl font-bold text-purple-800 flex items-center justify-center gap-2"><span>üóùÔ∏è</span> C√≥digo Emoji</h3>
                  <p class="text-xs text-purple-500 mt-1"><span class="italic">Pssst‚Ä¶ ¬°Los verdaderos esp√≠as siempre mantienen el c√≥digo en secreto!</span> üòâ</p>
              </div>
              <div id="emoji-code-grid" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-2 md:gap-3 flex-grow overflow-y-auto p-1"></div>
              <div class="mt-6 flex justify-center gap-4">
                  <button id="sm-home-btn" title="Back to Home" class="nav-btn btn-pink">
                      üè† <span class="ml-1">Inicio</span>
                  </button>
              </div>
          </div>
      </div>
  </div>

  <!-- PANEL HISTORIAL (Para 'Lanzar Dados') -->
  <div id="history-panel" class="fixed top-0 right-0 h-full w-full max-w-sm bg-white shadow-2xl p-4 flex flex-col transition-transform translate-x-full z-20" role="dialog" aria-modal="true" aria-labelledby="history-title">
    <div class="flex justify-between items-center mb-4 flex-shrink-0">
      <h2 id="history-title" class="text-2xl font-bold text-gray-800">Historial de tiradas</h2>
      <button id="close-history-btn" class="text-3xl font-bold text-gray-600 hover:text-red-500 leading-none" aria-label="Cerrar historial">&times;</button>
    </div>
    <div id="history-list" class="flex-grow overflow-y-auto space-y-3"></div>
    <button id="clear-history-btn" class="mt-4 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg w-full flex-shrink-0">üóëÔ∏è Borrar todo</button>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const $ = (id) => document.getElementById(id);

      // --- Declaraci√≥n de Pantallas ---
      const warmupScreen = $('warmup-screen');
      const diceChallengeScreen = $('dice-challenge-screen');
      const thisOrThatScreen = $('this-or-that-screen');
      const emojiDiceScreen = $('emoji-dice-screen');
      const secretMessageScreen = $('secret-message-screen');
      
      const allScreens = [warmupScreen, diceChallengeScreen, thisOrThatScreen, emojiDiceScreen, secretMessageScreen];

      const showScreen = (el) => {
        allScreens.forEach(s => s.classList.add('hidden'));
        el.classList.remove('hidden');
      };
      const goHome = () => showScreen(warmupScreen);

      const SHARED_EMOJIS = ['üòÇ','üòç','ü§î','üòé','üò¢','üò°','ü•≥','ü§Ø','üò¥','üëç','üëé','üôè','üí™','üëÄ','üß†','üê∂','üê±','üê≠','ü¶ä','üêª','üêº','üê®','üêØ','ü¶Å','üêÆ','üê∑','üê∏','üêµ','üêî','üêß','üê¶','üê§','ü¶Ü','ü¶Ö','ü¶â','ü¶á','üê∫','üêó','üê¥','ü¶Ñ','üêù','üêõ','ü¶ã','üêå','üêû','üêú','‚öΩÔ∏è','üèÄ','üèà','‚öæÔ∏è','üéæ','üèê','üèâ','üé±','üèì','üè∏','ü•Ö','üèí','üèë','üèè','‚õ≥Ô∏è','üèπ','üé£','ü•ä','ü•ã','üéΩ','‚õ∏','üéø','‚õ∑','üèÇ','üèãÔ∏è‚Äç‚ôÄÔ∏è','ü§º‚Äç‚ôÄÔ∏è','ü§∏‚Äç‚ôÄÔ∏è','ü§∫','ü§æ‚Äç‚ôÄÔ∏è','üèåÔ∏è‚Äç‚ôÄÔ∏è','üèá','üèÜ','ü•á','ü•à','ü•â','üé®','üé¨','üé§','üéß','üéº','üéπ','ü•Å','üé∑','üé∫','üé∏','üéª','üéÆ','üß©','üé≠','üöó','‚úàÔ∏è','üöÄ','üõ∏','üöÅ','‚õµÔ∏è','üè∞','üè†','‚ù§Ô∏è','üíî','üíØ','üî•','‚ú®','‚≠êÔ∏è','‚ö°Ô∏è','‚òÄÔ∏è','‚òÅÔ∏è','üåà','üåä','üçî','üçï','üçü','üéÇ','üç≠','üç©','üç™','‚òïÔ∏è','‚è∞','üí°','üí∞','üîë','üéÅ','üéâ'];

      // --- Gestor del Juego 1: "Lanzar Dados" ---
      const diceGameManager = (() => {
        const homeBtn2 = $('dice-home-btn-2');
        const consigna = $('consigna');
        const rollDiceBtn = $('roll-dice-btn');
        const emojiDisplay = $('emoji-display');
        const btnPlusRandom = $('btn-plus-random');
        const btnMinusRandom = $('btn-minus-random');
        const randomDiceDisplay = $('random-dice-display');
        const specificDiceSelection = $('specific-dice-selection');
        const totalDiceLaunchDisplay = $('total-dice-launch-display');
        const rollSound = new Audio('https://github.com/TamaraLlorens/warmup-assets/raw/refs/heads/main/button_06-190439.mp3');
        const saveRollSection = $('save-roll-section');
        const rollNameInput = $('roll-name-input');
        const saveRollBtn = $('save-roll-btn');
        const toggleHistoryBtn = $('toggle-history-btn');
        const historyPanel = $('history-panel');
        const closeHistoryBtn = $('close-history-btn');
        const historyList = $('history-list');
        const clearHistoryBtn = $('clear-history-btn');
        const DADOS_FILOSOFICOS = { 
            "Conceptos": ["imagenes/dios.png", "imagenes/libertad.png", "imagenes/tiempo.png", "imagenes/destino.png", "imagenes/esencia.png"], 
            "Autores": ["imagenes/autores/platon.png", "imagenes/autores/kant.png", "imagenes/autores/descartes.png", "imagenes/autores/nietzsche.png", "imagenes/autores/wittgenstein.png", "imagenes/autores/aristoteles.png", "imagenes/autores/spinoza.png", "imagenes/autores/aquino.png"], 
            "Acciones": ["imagenes/acciones/espiral.png", "imagenes/acciones/explosion.png", "imagenes/acciones/flechas.png", "imagenes/acciones/mano.png", "imagenes/acciones/mascara.png", "imagenes/acciones/caminar.png", "imagenes/acciones/construir.png", "imagenes/acciones/mirar.png", "imagenes/acciones/pensar.png", "imagenes/acciones/saltar.png", "imagenes/acciones/toser.png", "imagenes/acciones2/paracaidas.png"], 
            "Objetos": ["imagenes/objetos1/arcoiris.png", "imagenes/objetos1/balanza.png", "imagenes/objetos1/candado.png", "imagenes/objetos1/llave.png", "imagenes/objetos1/lupa.png"], 
            "Personajes": ["imagenes/personajes/astronauta.png", "imagenes/personajes/mago.png", "imagenes/personajes/nina.png", "imagenes/personajes/reina.png", "imagenes/personajes/superheroe.png"], 
            "√âtica y Pol√≠tica": ["imagenes/etica/Conexiones y Colaboraci√≥n.png", "imagenes/etica/Eslab√≥n de cadena minimalista.png", "imagenes/etica/Figura con antorcha y llama.png", "imagenes/etica/Figuras humanas minimalistas en azul.png", "imagenes/etica/huella dactilar estilizada.png", "imagenes/etica/Icono de libro abierto.png", "imagenes/etica/Icono de pergamino azul minimalista.png", "imagenes/etica/Icono de Templo Cl√°sico.png", "imagenes/etica/Icono minimalista de duda.png", "imagenes/etica/Puerta abierta en l√≠neas sencillas.png", "imagenes/etica/Pu√±o cerrado en blanco y negro.png"], 
            "ODS": ["imagenes/ODS/1ODS.png", "imagenes/ODS/2ODS.png", "imagenes/ODS/3ODS.png", "imagenes/ODS/4ODS.png", "imagenes/ODS/5ODS.png", "imagenes/ODS/6ODS.png", "imagenes/ODS/7ODS.png", "imagenes/ODS/8ODS.png", "imagenes/ODS/9ODS.png", "imagenes/ODS/10ODS.png", "imagenes/ODS/11ODS.png", "imagenes/ODS/12ODS.png", "imagenes/ODS/13ODS.png", "imagenes/ODS/14ODS.png", "imagenes/ODS/15ODS.png", "imagenes/ODS/16ODS.png"],
            "Derechos Humanos": ["imagenes/ddhh/1_dignidad.png", "imagenes/ddhh/2_igualdad.png", "imagenes/ddhh/3_vida.png", "imagenes/ddhh/4_no_esclavitud.png", "imagenes/ddhh/5_no_tortura.png", "imagenes/ddhh/6_personalidad_juridica.png", "imagenes/ddhh/7_igualdad_ley.png", "imagenes/ddhh/8_derecho_reparacion.png", "imagenes/ddhh/9_no_detencion_ilegal.png", "imagenes/ddhh/10_juicio_justo.png", "imagenes/ddhh/11_inocencia.png", "imagenes/ddhh/12_intimidad.png", "imagenes/ddhh/13_libre_desplazamiento.png", "imagenes/ddhh/14_asilo.png", "imagenes/ddhh/15_nacionalidad.png", "imagenes/ddhh/16_familia.png", "imagenes/ddhh/17_propiedad.png", "imagenes/ddhh/18_libertad_religiosa.png", "imagenes/ddhh/19_libertad_expresion.png", "imagenes/ddhh/20_libertad_asociacion.png"] 
        };
        const MAX_TOTAL_DICE = 9;
        let numRandomDice = 3;
        let historial = [];
        let tiradaActualResultados = null;
        let tiradaCounter = 1;
        const rand = (arr) => arr[Math.floor(Math.random() * arr.length)];
        function updateControlsAndState() { const numSpecificDice = specificDiceSelection.querySelectorAll('input:checked').length; const totalDice = numRandomDice + numSpecificDice; totalDiceLaunchDisplay.textContent = `${totalDice} Dado${totalDice !== 1 ? 's' : ''}`; btnMinusRandom.disabled = numRandomDice <= 0; btnPlusRandom.disabled = totalDice >= MAX_TOTAL_DICE; const toggles = specificDiceSelection.querySelectorAll('input[type="checkbox"]'); const lock = totalDice >= MAX_TOTAL_DICE; toggles.forEach(t => { t.disabled = !t.checked && lock; }); }
        function populateDiceToggles() { specificDiceSelection.innerHTML = ''; const frag = document.createDocumentFragment(); Object.keys(DADOS_FILOSOFICOS).forEach(name => { const id = `toggle-${name.replace(/\s+/g, '-')}`; const wrapper = document.createElement('div'); wrapper.className = 'dice-toggle-wrapper'; const checkbox = document.createElement('input'); checkbox.type = 'checkbox'; checkbox.id = id; checkbox.value = name; const label = document.createElement('label'); label.className = 'dice-toggle-label'; label.htmlFor = id; label.textContent = name; wrapper.append(checkbox, label); frag.appendChild(wrapper); }); specificDiceSelection.appendChild(frag); }
        function init() { homeBtn2.addEventListener('click', goHome); btnPlusRandom.addEventListener('click', () => changeRandomDice(1)); btnMinusRandom.addEventListener('click', () => changeRandomDice(-1)); specificDiceSelection.addEventListener('change', updateControlsAndState); rollDiceBtn.addEventListener('click', rollDice); saveRollBtn.addEventListener('click', saveRoll); toggleHistoryBtn.addEventListener('click', () => { const open = historyPanel.classList.toggle('is-open'); toggleHistoryBtn.setAttribute('aria-expanded', String(open)); }); closeHistoryBtn.addEventListener('click', () => historyPanel.classList.remove('is-open')); document.addEventListener('keydown', (e) => { if (e.key === 'Escape') historyPanel.classList.remove('is-open'); }); clearHistoryBtn.addEventListener('click', () => { if (confirm('¬øBorrar todo el historial?')) { historial = []; tiradaCounter = 1; guardarHistorialEnStorage(); renderizarHistorial(); } }); historyList.addEventListener('click', (e) => { const btn = e.target.closest('button'); if (!btn) return; const id = btn.dataset.id; if (!id) return; if (btn.classList.contains('load-btn')) cargarTirada(id); else if (btn.classList.contains('delete-btn')) { if (confirm('¬øEliminar esta tirada?')) { historial = historial.filter(t => t.id != id); guardarHistorialEnStorage(); renderizarHistorial(); } } }); cargarHistorial(); }
        function startGame() { showScreen(diceChallengeScreen); numRandomDice = 3; randomDiceDisplay.textContent = numRandomDice; populateDiceToggles(); updateControlsAndState(); emojiDisplay.innerHTML = ''; consigna.textContent = '¬°Configura tu tirada y pulsa ¬´Lanzar dados¬ª!'; saveRollSection.classList.add('hidden'); }
        function changeRandomDice(delta) { const numSpecificDice = specificDiceSelection.querySelectorAll('input:checked').length; const next = numRandomDice + delta; if (next + numSpecificDice <= MAX_TOTAL_DICE && next >= 0) { numRandomDice = next; randomDiceDisplay.textContent = numRandomDice; updateControlsAndState(); } }
        function rollDice() { const totalDice = numRandomDice + specificDiceSelection.querySelectorAll('input:checked').length; if (totalDice === 0) { alert('Selecciona al menos un dado.'); return; } rollSound.currentTime = 0; rollSound.play().catch(()=>{}); emojiDisplay.innerHTML = ''; const results = []; for (let i = 0; i < numRandomDice; i++) results.push({ type: 'emoji', value: rand(SHARED_EMOJIS) }); specificDiceSelection.querySelectorAll('input:checked').forEach(t => { results.push({ type: 'image', value: rand(DADOS_FILOSOFICOS[t.value]) }); }); tiradaActualResultados = results; const frag = document.createDocumentFragment(); results.forEach((res, i) => { const card = document.createElement('div'); card.className = 'bg-white rounded-xl shadow-lg pop-in'; card.style.animationDelay = `${i * 0.1}s`; if (res.type === 'emoji') { card.innerHTML = `<span class="emoji-shadow">${res.value}</span>`; } else { const img = new Image(); img.src = res.value; img.alt = 'Resultado de dado'; img.loading = 'lazy'; card.appendChild(img); } frag.appendChild(card); }); emojiDisplay.appendChild(frag); consigna.textContent = '¬°Aqu√≠ est√° tu resultado! Ponle un nombre y gu√°rdalo.'; saveRollSection.classList.remove('hidden'); rollNameInput.value = ''; rollNameInput.focus({ preventScroll: true }); }
        function saveRoll() { if (!tiradaActualResultados) return; const nombre = rollNameInput.value.trim(); const nueva = { id: Date.now(), name: nombre || `Tirada ${tiradaCounter}`, timestamp: new Date().toLocaleString('es-ES', { dateStyle: 'short', timeStyle: 'short' }), results: tiradaActualResultados }; historial.push(nueva); if (!nombre) tiradaCounter++; guardarHistorialEnStorage(); renderizarHistorial(); saveRollSection.classList.add('hidden'); tiradaActualResultados = null; consigna.textContent = '¬°Tirada guardada en el historial!'; }
        function cargarHistorial() { try { const guardado = localStorage.getItem('emojiDiceHistory'); const contadorGuardado = localStorage.getItem('emojiDiceCounter'); if (guardado) historial = JSON.parse(guardado) || []; if (contadorGuardado) tiradaCounter = parseInt(contadorGuardado, 10) || 1; } catch { historial = []; tiradaCounter = 1; } renderizarHistorial(); }
        function guardarHistorialEnStorage() { try { localStorage.setItem('emojiDiceHistory', JSON.stringify(historial)); localStorage.setItem('emojiDiceCounter', String(tiradaCounter)); } catch {} }
        function renderizarHistorial() { historyList.innerHTML = ''; if (historial.length === 0) { historyList.innerHTML = '<p class="text-gray-500 text-center mt-4">No hay tiradas guardadas.</p>'; return; } const frag = document.createDocumentFragment(); [...historial].reverse().forEach(tirada => { const item = document.createElement('div'); item.className = 'p-3 bg-gray-50 border border-gray-200 rounded-lg shadow-sm'; item.innerHTML = `<div class="flex justify-between items-start"><div><p class="font-bold text-gray-800">${tirada.name}</p><p class="text-xs text-gray-500">${tirada.timestamp}</p></div><div class="flex items-center gap-3"><button class="load-btn font-semibold text-sm text-blue-600 hover:text-blue-800" data-id="${tirada.id}">Cargar</button><button class="delete-btn text-red-500 hover:text-red-700 text-lg" data-id="${tirada.id}" aria-label="Eliminar">üóëÔ∏è</button></div></div>`; frag.appendChild(item); }); historyList.appendChild(frag); }
        function cargarTirada(id) { const t = historial.find(x => x.id == id); if (!t) return; saveRollSection.classList.add('hidden'); emojiDisplay.innerHTML = ''; const frag = document.createDocumentFragment(); t.results.forEach((res, i) => { const card = document.createElement('div'); card.className = 'bg-white rounded-xl shadow-lg pop-in'; card.style.animationDelay = `${i*0.1}s`; if (res.type === 'emoji') { card.innerHTML = `<span class="emoji-shadow">${res.value}</span>`; } else { const img = new Image(); img.src = res.value; img.alt = 'Resultado de dado'; img.loading = 'lazy'; card.appendChild(img); } frag.appendChild(card); }); emojiDisplay.appendChild(frag); consigna.textContent = `Viendo "${t.name}" del ${t.timestamp}.`; historyPanel.classList.remove('is-open'); }
        return { init, startGame };
      })();

      // --- Gestor del Juego 2: "¬øCu√°l eliges?" ---
      const thisOrThatGameManager = (() => {
        const homeBtn = $('tot-home-btn');
        const newChallengeBtn = $('tot-new-challenge-btn');
        const musicToggleBtn = $('tot-music-toggle-btn');
        const music = $('tot-background-music');
        const card1 = $('tot-card1');
        const card2 = $('tot-card2');
        const emoji1 = $('tot-emoji1');
        const text1 = $('tot-text1');
        const emoji2 = $('tot-emoji2');
        const text2 = $('tot-text2');
        const comparisons = [ { option1: { text: 'Libertad', emoji: 'üóΩ' }, option2: { text: 'Determinismo', emoji: 'üß¨' } }, { option1: { text: 'Raz√≥n', emoji: 'üß†' }, option2: { text: 'Emoci√≥n', emoji: '‚ù§Ô∏è' } }, { option1: { text: 'Fines', emoji: 'üéØ' }, option2: { text: 'Medios', emoji: 'üõ†' } }, { option1: { text: 'Naturaleza', emoji: 'üå≥' }, option2: { text: 'Cultura', emoji: 'üè∞' } }, { option1: { text: 'Tradici√≥n', emoji: '‚õ©' }, option2: { text: 'Progreso', emoji: 'üì±' } }, { option1: { text: 'Seguridad', emoji: 'üõ°' }, option2: { text: 'Libertad', emoji: 'üóΩ' } }, { option1: { text: 'Progreso tecnol√≥gico', emoji: 'ü§ñ' }, option2: { text: 'Preservar medio ambiente', emoji: 'üå≥' } }, { option1: { text: 'Nacionalismo', emoji: 'üè≥Ô∏è‚Äçüåà' }, option2: { text: 'Cosmopolitismo', emoji: 'üåç' } }, { option1: { text: 'Derechos individuales', emoji: 'üôãüèΩ‚Äç‚ôÄÔ∏è' }, option2: { text: 'Bien com√∫n', emoji: 'üë•' } }, { option1: { text: 'Datos abiertos', emoji: 'üìÇ' }, option2: { text: 'Privacidad', emoji: 'üîí' } }, { option1: { text: 'Ciencia', emoji: 'üî¨' }, option2: { text: 'Religi√≥n', emoji: '‚õ™Ô∏è' } }, { option1: { text: 'Inteligencia artificial', emoji: 'ü§ñ' }, option2: { text: 'Inteligencia humana', emoji: 'üß†' } }, { option1: { text: 'Competencia', emoji: 'üèÅ' }, option2: { text: 'Colaboraci√≥n', emoji: 'ü§ù' } }, { option1: { text: 'Relativismo moral', emoji: 'üåà' }, option2: { text: 'Universlaismo moral', emoji: 'üåê' } }, { option1: { text: 'Igualdad‚öñ', emoji: '‚öñÔ∏è' }, option2: { text: 'Meritocracia', emoji: 'üèÜ' } }, { option1: { text: 'Democracia directa', emoji: 'üó≥' }, option2: { text: 'Democracia representativa', emoji: 'üó£' } }, { option1: { text: 'Justicia retributiva', emoji: 'üî®' }, option2: { text: 'Justicia restaurativa', emoji: 'ü§≤üèº' } }, { option1: { text: 'Bien com√∫n', emoji: 'ü§ù' }, option2: { text: 'Inter√©s individual', emoji: 'üßçüèΩ' } }, { option1: { text: 'Alma', emoji: 'üëª' }, option2: { text: 'Cuerpo', emoji: 'üß†' } }, { option1: { text: 'Hombre bueno por naturaleza', emoji: 'üòá' }, option2: { text: 'Hombre malo por naturaleza', emoji: 'üòà' } }, { option1: { text: 'Realidad objetiva', emoji: 'üåç' }, option2: { text: 'Realidad subjetiva', emoji: 'üå§' } }, { option1: { text: 'Orden', emoji: 'üìè' }, option2: { text: 'Caos', emoji: 'üå™' } }, { option1: { text: 'Pacifismo', emoji: 'üïä' }, option2: { text: 'Belicismo', emoji: '‚öîÔ∏è' } }, { option1: { text: 'Optimismo', emoji: '‚òÄÔ∏è' }, option2: { text: 'Pesimismo', emoji: 'üåßÔ∏è' } }, { option1: { text: 'Libertad de expresi√≥n', emoji: 'üó£' }, option2: { text: 'Censura', emoji: 'üö´' } }, { option1: { text: 'Individualismo', emoji: 'üôã‚Äç‚ôÇÔ∏è' }, option2: { text: 'Colectivismo', emoji: 'üë•' } }, { option1: { text: 'Materialismo', emoji: 'üí∞' }, option2: { text: 'Espiritualismo', emoji: '‚ú®' } }, { option1: { text: 'Justicia social', emoji: '‚öñÔ∏è' }, option2: { text: 'Libre mercado', emoji: 'üíπ' } }, { option1: { text: 'Libertad acad√©mica', emoji: 'üéì' }, option2: { text: 'Control ideol√≥gico', emoji: 'üõë' } }];
        let usedCombinations = new Set();
        function showNewChallenge() { if (usedCombinations.size >= comparisons.length) { usedCombinations.clear(); } let challenge, randomIndex; do { randomIndex = Math.floor(Math.random() * comparisons.length); } while (usedCombinations.has(randomIndex)); usedCombinations.add(randomIndex); challenge = comparisons[randomIndex]; emoji1.textContent = challenge.option1.emoji; text1.textContent = challenge.option1.text; emoji2.textContent = challenge.option2.emoji; text2.textContent = challenge.option2.text; [card1, card2].forEach(c => c.classList.remove('pop-in')); void card1.offsetWidth; [card1, card2].forEach(c => c.classList.add('pop-in')); }
        function startGame() { showScreen(thisOrThatScreen); usedCombinations.clear(); showNewChallenge(); music.play().then(() => { musicToggleBtn.textContent = 'üîà'; }).catch(() => { musicToggleBtn.textContent = 'ÔøΩ'; }); }
        function stopGame() { music.pause(); music.currentTime = 0; goHome(); }
        function init() { homeBtn.addEventListener('click', stopGame); newChallengeBtn.addEventListener('click', showNewChallenge); musicToggleBtn.addEventListener('click', () => { if (music.paused) { music.play(); musicToggleBtn.textContent = 'üîà'; } else { music.pause(); musicToggleBtn.textContent = 'üîá'; } }); }
        return { init, startGame };
      })();

      // --- Gestor del Juego 3: "Conceptos Filos√≥ficos" ---
      const emojiDiceMinigameManager = (() => {
        const homeBtn = $('ed-home-btn');
        const rollBtn = $('ed-roll-dice-btn');
        const btnPlus = $('ed-btn-plus');
        const btnMinus = $('ed-btn-minus');
        const emojiCountDisplay = $('ed-emoji-count-display');
        const groupingSelect = $('ed-grouping-select');
        const customWordsTA = $('ed-custom-words');
        const emojiDisplay = $('ed-emoji-display');
        const wordDisplayCard = $('ed-word-display-card');
        const wordDisplay = $('ed-word-display');
        const consigna = $('ed-consigna');
        const stepsSection = $('ed-steps-section');
        const stepsContainer = $('ed-steps-container');
        const emojiMainBlock = $('ed-emoji-main-block');
        
        let numEmojis = 3;
        let activeWords = [];
        const DEFAULT_WORDS = [ 'pensar','crear','escribir','leer','re√≠r','bailar','volar','nadar','hablar','escuchar','mirar','encontrar','ayudar','usar','abrir','cerrar','empezar','parar','caminar','cambiar','imaginar','compartir','ganar','construir','dibujar','cantar','explorar','descubrir','resolver','visitar','viajar','cocinar','ver','aprender', 'feliz','triste','grande','peque√±o','r√°pido','lento','rojo','azul','verde','amarillo','soleado','lluvioso','nublado','valiente','fuerte','amable','listo','delicioso','bonito','asombroso','interesante','aburrido','nuevo','viejo','joven','ruidoso','silencioso','brillante','oscuro','pesado','ligero','bueno','malo','emocionado','cansado','enfadado','hambriento','sediento','fr√≠o','caliente','divertido','misterioso','m√°gico','gigante','min√∫sculo','colorido','invisible','extra√±o','fant√°stico','genial','maravilloso','pac√≠fico','secreto','antiguo','moderno','r√°pidamente','lentamente','de repente','finalmente','despu√©s','antes','cuando','mientras','si','o','tambi√©n','porque','entonces','cerca','lejos','encima','debajo','dentro','fuera' ];
        const stepsData = [ { title:'PASO 1/3: PENSAR üß†', instructions:'Comenta ideas con tu pareja/grupo.' }, { title:'PASO 2/3: CREAR ‚úçÔ∏è',  instructions:'Escribid el texto juntos.' }, { title:'PASO 3/3: COMPARTIR üé§', instructions:'¬°Presentad vuestro texto a la clase!' } ];

        let audioCtx;
        const beep = (f=880, ms=120)=>{ try{ audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)(); const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.type='sine'; osc.frequency.value=f; gain.gain.setValueAtTime(0.0001,audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.2,audioCtx.currentTime+0.01); gain.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+ms/1000); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + ms/1000 + 0.02); }catch{} };
        
        const rand = (arr)=> arr[Math.floor(Math.random()*arr.length)];
        const parseCustomWords = (raw)=> (raw||'').split(/[\n,;]+/g).map(w=>w.trim()).filter(Boolean).filter(w=>w.length<=30);
        const setEmojiGridCols = (n)=>{ emojiDisplay.style.gridTemplateColumns = `repeat(${Math.min(n,6)}, minmax(64px,1fr))`; };

        const changeEmojiCount = (delta) => {
            const newValue = numEmojis + delta;
            if (newValue >= 3 && newValue <= 9) {
                numEmojis = newValue;
                emojiCountDisplay.textContent = numEmojis;
                btnMinus.disabled = numEmojis <= 3;
                btnPlus.disabled = numEmojis >= 9;
            }
        };

        const resetSteps = ()=>{
            const grouping = groupingSelect.value;
            if(grouping==='Individual'){
                stepsContainer.classList.add('hidden');
                emojiMainBlock.classList.remove('md:w-3/5');
                emojiMainBlock.classList.add('w-full');
                return;
            }
            stepsContainer.classList.remove('hidden');
            emojiMainBlock.classList.remove('w-full');
            emojiMainBlock.classList.add('md:w-3/5');
            stepsSection.innerHTML = ` <div class="text-center"><h3 id="ed-step-title" class="text-2xl sm:text-3xl font-bold text-pink-600"></h3></div> <div class="text-center flex-grow flex items-center justify-center p-2 min-h-[6rem]"> <p id="ed-step-instructions" class="text-gray-700 text-base sm:text-lg font-medium"></p> </div> <div class="flex justify-center"> <button id="ed-next-step-btn" class="py-2 px-6 rounded-xl shadow-md text-white font-semibold" style="background-image:linear-gradient(to right,#a2d2ff,#bde0fe);">‚û°Ô∏è Siguiente paso</button> </div>`;
            let currentStep=1;
            const update=()=>{
                const d = stepsData[currentStep-1];
                $('ed-step-title').textContent = d.title;
                $('ed-step-instructions').textContent = d.instructions;
                $('ed-next-step-btn').textContent = (currentStep===3)?'üéâ Terminar':'‚û°Ô∏è Siguiente paso';
            };
            $('ed-next-step-btn').addEventListener('click', ()=>{
                if(currentStep<3){ currentStep++; update(); }
                else{
                    stepsContainer.classList.add('hidden');
                    emojiMainBlock.classList.remove('md:w-3/5');
                    emojiMainBlock.classList.add('w-full');
                }
            });
            update();
        };

        const roll = ()=>{
            const custom = parseCustomWords(customWordsTA.value);
            activeWords = custom.length ? custom : [...DEFAULT_WORDS];
            
            const n = numEmojis;
            emojiDisplay.innerHTML = '';
            setEmojiGridCols(n);
            const frag = document.createDocumentFragment();
            for(let i=0;i<n;i++){
                const e = rand(SHARED_EMOJIS);
                const card = document.createElement('div');
                card.className='bg-white rounded-2xl shadow-lg p-2 sm:p-4 flex items-center justify-center aspect-square pop-in';
                card.style.animationDelay = `${i*0.06}s`;
                card.innerHTML = `<span class="text-5xl sm:text-7xl" style="text-shadow:0 4px 10px rgba(0,0,0,.15);">${e}</span>`;
                frag.appendChild(card);
            }
            emojiDisplay.appendChild(frag);
            const word = rand(activeWords);
            wordDisplay.textContent = word;
            wordDisplayCard.classList.remove('hidden');
            consigna.textContent = `Usa los ${n} emojis y la palabra ¬´${word}¬ª para crear una frase.`;
            beep(900,110);
            resetSteps();
        };
        
        function init() {
            homeBtn.addEventListener('click', goHome);
            btnPlus.addEventListener('click', () => changeEmojiCount(1));
            btnMinus.addEventListener('click', () => changeEmojiCount(-1));
            groupingSelect.addEventListener('change', resetSteps);
            rollBtn.addEventListener('click', roll);
        }

        function startGame() {
            showScreen(emojiDiceScreen);
            // Resetear a valores por defecto al iniciar
            numEmojis = 3;
            emojiCountDisplay.textContent = '3';
            btnMinus.disabled = true;
            btnPlus.disabled = false;
            groupingSelect.value = 'Individual';
            customWordsTA.value = '';
            emojiDisplay.innerHTML = '<div class="text-center text-gray-400 p-6 col-span-3">Configura tu partida y pulsa ‚ÄúTirar dados‚Äù para empezar</div>';
            wordDisplayCard.classList.add('hidden');
            consigna.textContent = '';
            resetSteps();
        }

        return { init, startGame };
      })();

      // --- Gestor del Juego 4: "Mensaje Secreto" ---
      const secretMessageManager = (() => {
        const mainAppContainer = $('main-app-container');
        const homeBtn = $('sm-home-btn');
        const tabDecode = $('tab-decode');
        const tabEncode = $('tab-encode');
        const decodeSection = $('decode-section');
        const encodeSection = $('encode-section');
        const levelSelectionArea = $('level-selection-area');
        const gameArea = $('game-area');
        const levelEasyBtn = $('level-easy-btn');
        const levelHardBtn = $('level-hard-btn');
        const changeLevelBtn = $('change-level-btn');
        const secretMessageDisplay = $('secret-message-display');
        const decodeInput = $('decode-input');
        const feedbackMessage = $('feedback-message');
        const checkBtn = $('check-btn');
        const newMessageBtn = $('new-message-btn');
        const showCodeBtn = $('show-code-btn');
        const codeTablePanel = $('code-table-panel');
        const emojiCodeGrid = $('emoji-code-grid');
        const encodeInputArea = $('encode-input-area');
        const encodeRevealArea = $('encode-reveal-area');
        const encodeInput = $('encode-input');
        const encodeBtn = $('encode-btn');
        const encodedOutput = $('encoded-output');
        const backToCreateBtn = $('back-to-create-btn');
        const confettiContainer = $('confetti-container');
        const inputWatermark = $('input-watermark');
        const newMessageSound = new Audio('https://github.com/TamaraLlorens/warmup-assets/raw/refs/heads/main/button_06-190439.mp3');

        const EMOJI_CIPHER = { 'A': 'üê∂', 'B': 'üçå', 'C': 'üê±', 'D': 'ü¶ñ', 'E': 'üçé', 'F': 'üê∏', 'G': 'üåà', 'H': 'üêπ', 'I': 'üç¶', 'J': 'üéà', 'K': 'üê®', 'L': 'üçã', 'M': 'üêµ', 'N': 'üçâ', 'O': 'üêô', 'P': 'üêß', 'Q': 'üßÅ', 'R': 'ü§ñ', 'S': '‚òÄÔ∏è', 'T': 'üß∏', 'U': 'ü¶Ñ', 'V': 'üçá', 'W': 'üê∫', 'X': '‚ùå', 'Y': 'üåª', 'Z': 'ü¶ì' };
        const EMOJI_NAMES = { 'üê∂': 'dog', 'üçå': 'banana', 'üê±': 'cat', 'ü¶ñ': 'dinosaur', 'üçé': 'apple', 'üê∏': 'frog', 'üåà': 'rainbow', 'üêπ': 'hamster', 'üç¶': 'ice cream', 'üéà': 'balloon', 'üê®': 'koala', 'üçã': 'lemon', 'üêµ': 'monkey', 'üçâ': 'watermelon', 'üêô': 'octopus', 'üêß': 'penguin', 'üßÅ': 'cupcake', 'ü§ñ': 'robot', '‚òÄÔ∏è': 'sun', 'üß∏': 'teddy bear', 'ü¶Ñ': 'unicorn', 'üçá': 'grapes', 'üê∫': 'wolf', '‚ùå': 'cross', 'üåª': 'sunflower', 'ü¶ì': 'zebra' };
        const SECRET_WORDS = ["KANT", "PLATON", "ARISTOTELES", "NIETZSCHE", "SARTRE", "DESCARTES", "SPINOZA", "HUME", "LOCKE", "HEGEL"];
        const SECRET_SENTENCES = ["SOLO SE QUE NO SE NADA", "PIENSO LUEGO EXISTO", "EL HOMBRE ES UN LOBO PARA EL HOMBRE", "DIOS HA MUERTO", "LA EXISTENCIA PRECEDE A LA ESENCIA", "EL FIN JUSTIFICA LOS MEDIOS", "CONOCETE A TI MISMO", "VIVIR ES SUFRIR", "LA VIDA ES ABSURDA"];
        
        let currentSecretMessage = '';
        let currentLevel = '';

        function startGame() {
            showScreen(secretMessageScreen);
            mainAppContainer.classList.remove('hidden');
            mainAppContainer.classList.add('flex');
            updateSecretMessageLayout();
        }
        
        const updateSecretMessageLayout = () => {
            const isMobile = window.innerWidth < 768; // md
            if (isMobile) {
                showCodeBtn.classList.remove('hidden');
                if (!codeTablePanel.dataset.toggled) {
                    codeTablePanel.classList.add('hidden');
                }
            } else {
                showCodeBtn.classList.add('hidden');
                codeTablePanel.classList.remove('hidden');
                codeTablePanel.classList.add('flex');
            }
        };

        const initSpeech = () => {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.getVoices();
            }
        };

        const switchView = (view) => {
            const isDecode = view === 'decode';
            decodeSection.classList.toggle('hidden', !isDecode);
            encodeSection.classList.toggle('hidden', isDecode);
            tabDecode.classList.toggle('tab-active', isDecode);
            tabEncode.classList.toggle('tab-active', !isDecode);
            if (isDecode) {
                showLevelSelection();
            }
        };
        
        const textToEmojiHTML = (text, container) => {
            container.innerHTML = '';
            const words = text.toUpperCase().split(' ');

            words.forEach((word, index) => {
                const wordWrapper = document.createElement('div');
                wordWrapper.className = 'inline-flex flex-wrap'; 

                for (const char of word) {
                    if (EMOJI_CIPHER[char]) {
                        const emoji = EMOJI_CIPHER[char];
                        const flipCard = document.createElement('div');
                        flipCard.className = 'flip-card';
                        flipCard.innerHTML = `
                            <div class="flip-card-inner">
                                <div class="flip-card-front">${emoji}</div>
                                <div class="flip-card-back">${char}</div>
                            </div>`;
                        wordWrapper.appendChild(flipCard);
                    } else if (char.trim() !== '') {
                        const nonFlipCard = document.createElement('div');
                        nonFlipCard.className = 'flip-card';
                        nonFlipCard.innerHTML = `<div class="flip-card-inner"><div class="flip-card-front">${char}</div><div class="flip-card-back">${char}</div></div>`;
                        wordWrapper.appendChild(nonFlipCard);
                    }
                }
                container.appendChild(wordWrapper);

                if (index < words.length - 1) {
                    const space = document.createElement('div');
                    space.className = 'emoji-space';
                    container.appendChild(space);
                }
            });
        };
        
        const addFlipListener = (container) => {
            container.addEventListener('click', (e) => {
                const flipCard = e.target.closest('.flip-card');
                if (flipCard) {
                    flipCard.classList.toggle('is-flipped');
                }
            });
        };

        const triggerConfetti = () => {
            confettiContainer.innerHTML = '';
            for (let i = 0; i < 30; i++) {
                const confetti = document.createElement('div');
                confetti.style.cssText = `position: absolute; width: 10px; height: 10px; background-color: hsl(${Math.random() * 360}, 100%, 50%); opacity: 0; animation: fall 3s ease-in-out forwards;`;
                confetti.style.left = `${Math.random() * 100 - 50}px`;
                confetti.style.animationDelay = `${Math.random() * 2}s`;
                confettiContainer.appendChild(confetti);
            }
        };
        
        const generateNewMessageContent = () => {
            const sourceArray = currentLevel === 'easy' ? SECRET_WORDS : SECRET_SENTENCES;
            let newMessage;
            do {
                newMessage = sourceArray[Math.floor(Math.random() * sourceArray.length)];
            } while (newMessage === currentSecretMessage && sourceArray.length > 1);
            currentSecretMessage = newMessage;
            textToEmojiHTML(currentSecretMessage, secretMessageDisplay);
            decodeInput.value = '';
            feedbackMessage.textContent = '\xa0';
        };

        const checkAnswer = () => {
            const userAnswer = decodeInput.value.trim().toUpperCase();
            if (userAnswer === currentSecretMessage) {
                feedbackMessage.textContent = '¬°Correcto! üéâ';
                feedbackMessage.className = 'h-6 text-lg font-bold text-green-600';
                triggerConfetti();
            } else {
                feedbackMessage.textContent = '¬°Int√©ntalo de nuevo! ü§î';
                feedbackMessage.className = 'h-6 text-lg font-bold text-red-600';
            }
        };
        
        const speak = (text) => {
            if (!('speechSynthesis' in window)) return;
            const utterance = new SpeechSynthesisUtterance(text);
            const setVoiceAndSpeak = () => {
                const voices = speechSynthesis.getVoices();
                let selectedVoice = voices.find(voice => voice.lang === 'es-ES');
                if (selectedVoice) utterance.voice = selectedVoice;
                utterance.lang = 'es-ES';
                utterance.rate = 0.9;
                utterance.pitch = 1;
                window.speechSynthesis.cancel();
                window.speechSynthesis.speak(utterance);
            };
            if (speechSynthesis.getVoices().length > 0) {
                setVoiceAndSpeak();
            } else {
                speechSynthesis.onvoiceschanged = setVoiceAndSpeak;
            }
        };

        const populateCodeTable = () => {
            emojiCodeGrid.innerHTML = '';
            Object.keys(EMOJI_CIPHER).forEach(letter => {
                const cell = document.createElement('div');
                cell.className = 'code-cell';
                cell.innerHTML = `<span class="font-bold text-lg md:text-xl">${letter}</span><span class="text-lg md:text-xl">=</span><span class="text-2xl md:text-3xl">${EMOJI_CIPHER[letter]}</span>`;
                cell.addEventListener('click', () => {
                    const emoji = EMOJI_CIPHER[letter];
                    
                    const isEncodeActive = !encodeSection.classList.contains('hidden');
                    const targetInput = isEncodeActive ? encodeInput : decodeInput;
                    targetInput.value += emoji;
                    if(isEncodeActive) {
                        inputWatermark.classList.add('hidden');
                    }
                    targetInput.focus();

                    const emojiName = EMOJI_NAMES[emoji] || 'emoji';
                    speak(`${letter} es para ${emojiName}.`);
                });
                emojiCodeGrid.appendChild(cell);
            });
        };

        const createOwnMessage = () => {
            const textToEncode = encodeInput.value.trim();
            if (!textToEncode) return;
            textToEmojiHTML(textToEncode, encodedOutput);
            encodeInputArea.classList.add('hidden');
            encodeRevealArea.classList.remove('hidden');
        };
        
        const resetCreateView = () => {
            encodeRevealArea.classList.add('hidden');
            encodeInputArea.classList.remove('hidden');
            encodeInput.value = '';
            inputWatermark.classList.remove('hidden');
        };

        const showLevelSelection = () => {
            levelSelectionArea.classList.remove('hidden');
            gameArea.classList.add('hidden');
        };

        const startDecodeLevel = (level) => {
            currentLevel = level;
            levelSelectionArea.classList.add('hidden');
            gameArea.classList.remove('hidden');
            generateNewMessageContent();
        };

        function init() {
            homeBtn.addEventListener('click', goHome);
            tabDecode.addEventListener('click', () => switchView('decode'));
            tabEncode.addEventListener('click', () => switchView('encode'));
            levelEasyBtn.addEventListener('click', () => startDecodeLevel('easy'));
            levelHardBtn.addEventListener('click', () => startDecodeLevel('hard'));
            changeLevelBtn.addEventListener('click', showLevelSelection);
            
            if (showCodeBtn) {
                showCodeBtn.addEventListener('click', () => {
                    codeTablePanel.classList.toggle('hidden');
                    codeTablePanel.classList.toggle('flex');
                    codeTablePanel.dataset.toggled = !codeTablePanel.classList.contains('hidden');
                });
            }

            newMessageBtn.addEventListener('click', () => {
                newMessageSound.currentTime = 0;
                newMessageSound.play();
                generateNewMessageContent();
            });
            checkBtn.addEventListener('click', checkAnswer);
            decodeInput.addEventListener('keyup', (e) => { if (e.key === 'Enter') checkAnswer(); });
            encodeBtn.addEventListener('click', createOwnMessage);
            backToCreateBtn.addEventListener('click', resetCreateView);
            encodeInput.addEventListener('input', () => {
                inputWatermark.classList.toggle('hidden', encodeInput.value.length > 0);
            });
            
            document.body.addEventListener('click', initSpeech, { once: true });
            document.body.addEventListener('touchstart', initSpeech, { once: true });
            window.addEventListener('resize', updateSecretMessageLayout);
            addFlipListener(secretMessageDisplay);
            addFlipListener(encodedOutput);
            populateCodeTable();
        }

        return { init, startGame };
      })();
      
      // --- INICIALIZACI√ìN Y NAVEGACI√ìN PRINCIPAL ---
      diceGameManager.init();
      thisOrThatGameManager.init();
      secretMessageManager.init();
      emojiDiceMinigameManager.init();

      $('go-to-dice-challenge-btn').addEventListener('click', diceGameManager.startGame);
      $('go-to-this-or-that-btn').addEventListener('click', thisOrThatGameManager.startGame);
      $('go-to-secret-message-btn').addEventListener('click', secretMessageManager.startGame);
      $('go-to-emoji-says-btn').addEventListener('click', emojiDiceMinigameManager.startGame);

    });
  </script>
</body>
</html>
ÔøΩ
